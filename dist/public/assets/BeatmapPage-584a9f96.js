import{d as T,U as E,M as Q,S as F,m as V,T as w,B as O,_ as S,o as n,c as I,w as L,a as s,b as y,v as C,e as l,r as B,t as _,F as $,f as D,g as G,h as j,i as h,j as f,k,n as M,l as U,p as R,q as u,s as W,u as K,x as Y,y as z,z as A,A as q,C as H,D as J}from"./index-7b48ad06.js";import{M as X}from"./ModalDialog-07aa3844.js";import{F as Z}from"./FilterBox-97d85611.js";import{M as x,F as N}from"./extras-6db0000d.js";import{B as P,a as ee,_ as te,Q as se,E as ae}from"./EditBeatmapModal-613f5cfa.js";import"./TasksChoice-719782ea.js";const oe=T({name:"CreateBeatmapModal",components:{ModalDialog:X,UserLinkList:E,ModesIcons:Q},data(){return{featuredArtists:[],featuredSongs:[],selectedArtist:"",artistInput:"",selectedSong:"",selectedMode:"osu",selectedTaskStatus:"",previousSelectedMode:"",selectedTaskMode:"osu",checkedLocks:[],modes:[{value:"osu",name:"osu!"},{value:"taiko",name:"osu!taiko"},{value:"catch",name:"osu!catch"},{value:"mania",name:"osu!mania"},{value:"hybrid",name:"Multiple modes"}],tasks:F,newTaskName:"",newTaskMapper:"",tempTasks:[]}},computed:{...V(["loggedInUser"]),filteredTasks(){return this.selectedMode=="taiko"?[...F].filter(e=>e!=w.Hitsounds):F},sortedTasks(){const e=F,t=["osu","taiko","catch","mania","hs","sb"];return[...this.tempTasks].sort(function(i,r){return e.indexOf(i.name)-e.indexOf(r.name)}).sort(function(i,r){return t.indexOf(i.mode)-t.indexOf(r.mode)})}},watch:{selectedMode(){if(this.selectedMode==O.Taiko){const e=this.tempTasks.findIndex(t=>t.name==w.Hitsounds);e>=0&&(this.tempTasks.splice(e,1),this.newTaskName="")}this.selectedMode==O.Hybrid&&(this.tempTasks=[]),this.previousSelectedMode==O.Hybrid&&(this.tempTasks=[]),this.previousSelectedMode=this.selectedMode}},async created(){const e=await this.$http.executeGet("/featuredArtists");e&&(this.featuredArtists=e.sort((t,a)=>t.label.toLowerCase()>a.label.toLowerCase()?1:a.label.toLowerCase()>t.label.toLowerCase()?-1:0))},methods:{async setArtist(e){if(!this.selectedArtist&&!this.artistInput){this.$store.dispatch("updateToastMessages",{message:"Select or type an artist!",type:"danger"});return}if(this.artistInput){const a=this.featuredArtists.find(i=>i.label.toLowerCase().includes(this.artistInput.toLowerCase()));a&&(this.selectedArtist=a.id)}if(!this.selectedArtist){this.$store.dispatch("updateToastMessages",{message:"Couldn't find artist! Check your typing or select one from the list.",type:"danger"});return}e.target.disabled=!0;const t=await this.$http.executeGet(`/featuredArtists/${this.selectedArtist}/songs`);t&&(this.featuredSongs=t.sort((a,i)=>a.title.toLowerCase()>i.title.toLowerCase()?1:i.title.toLowerCase()>a.title.toLowerCase()?-1:0)),e.target.disabled=!1},async addTempTask(e){if(!this.newTaskName.length||!this.selectedTaskStatus.length){this.$store.dispatch("updateToastMessages",{message:"Missing task or status",type:"danger"});return}const t=this.tempTasks.find(r=>r.name==w.Hitsounds),a=this.tempTasks.find(r=>r.name==w.Storyboard);if(t&&this.newTaskName==w.Hitsounds){this.$store.dispatch("updateToastMessages",{message:'Only one "Hitsounds" task allowed',type:"danger"});return}if(a&&this.newTaskName==w.Storyboard){this.$store.dispatch("updateToastMessages",{message:'Only one "Storyboard" task allowed',type:"danger"});return}const i=await this.$http.executeGet(`/beatmaps/validateUsers/${this.newTaskMapper.length?this.newTaskMapper:this.loggedInUser.username}`,e);i&&i.length&&this.tempTasks.push({name:this.newTaskName,mappers:i,mode:this.selectedTaskMode,status:this.selectedTaskStatus,random:Math.random().toString()})},removeTempTask(e){const t=this.tempTasks.findIndex(a=>a.random==e);this.tempTasks.splice(t,1)},async saveNewMap(e){if(!this.selectedSong){this.$store.dispatch("updateToastMessages",{message:"Select a song!",type:"info"});return}const t=await this.$http.executePost("/beatmaps/create/",{song:this.selectedSong,tasks:this.tempTasks,tasksLocked:this.checkedLocks,mode:this.selectedMode},e);this.$http.isError(t)||(this.$bs.hideModal("addBeatmap"),this.$store.commit("beatmaps/addBeatmap",t))}}});const d=e=>(K("data-v-57c0fa59"),e=e(),Y(),e),ie={class:"container"},ne={class:"mb-3 row"},le=d(()=>s("div",{class:"col-lg-1"},[s("p",{style:{"margin-top":"3px"}}," Artist: ")],-1)),de={class:"col-lg-11"},re={id:"artistForm",class:"input-group input-group-sm mb-3"},ue=d(()=>s("option",{value:""}," Select an artist ",-1)),ce=d(()=>s("option",{value:"-",disabled:""}," --- ",-1)),pe=["value"],me=d(()=>s("div",{class:"col-lg-1"},[s("p",{style:{"margin-top":"3px"}}," Song: ")],-1)),he={class:"col-lg-11"},fe=["disabled"],_e=d(()=>s("option",{value:"",disabled:""}," Select an artist to view songs ",-1)),be=d(()=>s("option",{value:"-",disabled:""}," --- ",-1)),ge=["value"],ke=d(()=>s("hr",null,null,-1)),ye=d(()=>s("p",null," Game-mode: ",-1)),Be={class:"mb-3 row"},$e={class:"col-sm-10"},ve=["id","value"],we=["for"],Me=d(()=>s("br",null,null,-1)),Te=d(()=>s("hr",null,null,-1)),Se=d(()=>s("div",{class:"mb-2"},[f(" Set your mapset's difficulties "),s("div",{class:"small text-secondary"}," These can be changed later. ")],-1)),Le={key:0,class:"table table-sm"},Ce=d(()=>s("thead",null,[s("tr",null,[s("th",null,"Difficulty"),s("th",null,"Mapper(s)"),s("th",null,"Status"),s("th")])],-1)),Ie={class:"text-secondary"},Fe=["onClick"],Oe=d(()=>s("i",{class:"fas fa-times"},null,-1)),Ve=[Oe],Ae={class:"col-sm-12"},Ue={class:"input-group input-group-sm mx-auto"},De=d(()=>s("option",{value:"",disabled:"",selected:""}," Select a task ",-1)),Ge=["value"],Ne=d(()=>s("option",{value:"osu"}," osu! ",-1)),Qe=d(()=>s("option",{value:"taiko"}," osu!taiko ",-1)),qe=d(()=>s("option",{value:"catch"}," osu!catch ",-1)),He=d(()=>s("option",{value:"mania"}," osu!mania ",-1)),Pe=[Ne,Qe,qe,He],Ee=d(()=>s("option",{value:"",disabled:"",selected:""}," Select a status ",-1)),je=d(()=>s("option",{value:"WIP"}," Work-in-progress ",-1)),Re=d(()=>s("option",{value:"Done"}," Done ",-1)),We=[Ee,je,Re],Ke=d(()=>s("i",{class:"fas fa-plus"},null,-1)),Ye=[Ke],ze={class:"text-secondary small mt-1"},Je={class:"small"},Xe=d(()=>s("li",null,'You can leave the "mapper" field empty for your own difficulties.',-1)),Ze=d(()=>s("li",null,'Use comma separation for collabs, like "mapper1, mapper2".',-1)),xe=d(()=>s("li",null,'There can only be one entry for "Storyboard" and "Hitsounds".',-1)),et={key:0},tt=d(()=>s("hr",null,null,-1)),st=d(()=>s("div",{class:"mb-2"},[f(" Set any difficulties that nobody else is allowed to claim. "),s("div",{class:"small text-secondary"}," For example, if you don't want any guest difficulties, you should select all. These can be changed later. ")],-1)),at={class:"mb-3 row"},ot={class:"col-sm-10"},it=["id","value"],nt=["for"],lt=d(()=>s("div",{class:"radial-divisor"},null,-1)),dt={class:"small text-secondary mt-2"},rt={class:"small"},ut=d(()=>s("i",null,"after",-1)),ct=d(()=>s("li",null,[f("Your beatmap was ranked "),s("i",null,"after"),f(" the Featured Artist was announced, excluding maps created for the announcement")],-1)),pt=d(()=>s("li",null,"Difficulties match between Mappers' Guild and osu! website (including difficulty levels and mappers)",-1)),mt=d(()=>s("li",null,[s("b",null,"Try to get permission for your map's background."),f(" It's unrealistic (and annoying to mappers) to police all background usage, but if you support the goal of the Mappers' Guild, please use appropriately permitted backgrounds. At minimum, your background should not be AI generated nor contain content from other media franchises (like Mikasa from Attack on Titan), excluding creative commons content (like Hatsune Miku) or content permitted by franchise owners (like Touhou).")],-1));function ht(e,t,a,i,r,g){const c=u("modes-icons"),p=u("user-link-list"),m=u("modal-dialog"),b=W("bs-tooltip");return n(),I(m,{id:"addBeatmap",title:"Add beatmap"},{default:L(()=>[s("div",ie,[s("div",ne,[le,s("div",de,[s("div",re,[y(s("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>e.selectedArtist=o),class:"form-select"},[ue,ce,(n(!0),l($,null,B(e.featuredArtists,o=>(n(),l("option",{key:o.id,value:o.id},_(o.label),9,pe))),128))],512),[[C,e.selectedArtist]]),y(s("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>e.artistInput=o),type:"text",class:"form-control",placeholder:"or input the artist's name...",onKeyup:t[2]||(t[2]=G(o=>e.setArtist(o),["enter"]))},null,544),[[D,e.artistInput]]),s("button",{id:"artistButton",class:"btn btn-outline-info",onClick:t[3]||(t[3]=o=>e.setArtist(o))}," Load songs ")])]),me,s("div",he,[y(s("select",{"onUpdate:modelValue":t[4]||(t[4]=o=>e.selectedSong=o),class:"form-select form-select-sm",disabled:!e.featuredSongs.length},[_e,be,(n(!0),l($,null,B(e.featuredSongs,o=>(n(),l("option",{key:o.id,value:o.id},_(o.title)+" --- ("+_(o.artist)+") ",9,ge))),128))],8,fe),[[C,e.selectedSong]])])]),ke,ye,s("div",Be,[s("div",$e,[(n(!0),l($,null,B(e.modes,o=>(n(),l("div",{key:o.value,class:"form-check form-check-inline"},[y(s("input",{id:o.value,"onUpdate:modelValue":t[5]||(t[5]=v=>e.selectedMode=v),class:"form-check-input",type:"radio",value:o.value},null,8,ve),[[j,e.selectedMode]]),s("label",{class:"form-check-label",for:o.value},_(o.name),9,we)]))),128)),Me])]),Te,Se,e.tempTasks.length?(n(),l("table",Le,[Ce,h(U,{tag:"tbody",name:"list"},{default:L(()=>[(n(!0),l($,null,B(e.tempTasks,o=>(n(),l("tr",{key:o.random},[s("td",Ie,[f(_(o.name)+" ",1),e.selectedMode=="hybrid"?(n(),I(c,{key:0,modes:[o.mode],color:"secondary"},null,8,["modes"])):k("",!0)]),s("td",null,[h(p,{users:o.mappers},null,8,["users"])]),s("td",{class:M(o.status=="WIP"?"text-wip":"text-success")},_(o.status),3),s("td",null,[y((n(),l("a",{href:"#",class:"text-danger",onClick:v=>e.removeTempTask(o.random)},Ve,8,Fe)),[[b,"delete"]])])]))),128))]),_:1})])):k("",!0),s("div",Ae,[s("div",Ue,[y(s("select",{"onUpdate:modelValue":t[6]||(t[6]=o=>e.newTaskName=o),class:"form-select"},[De,(n(!0),l($,null,B(e.filteredTasks,o=>(n(),l("option",{key:o,value:o},_(o),9,Ge))),128))],512),[[C,e.newTaskName]]),e.selectedMode=="hybrid"?y((n(),l("select",{key:0,"onUpdate:modelValue":t[7]||(t[7]=o=>e.selectedTaskMode=o),class:"form-select"},Pe,512)),[[C,e.selectedTaskMode]]):k("",!0),y(s("select",{"onUpdate:modelValue":t[8]||(t[8]=o=>e.selectedTaskStatus=o),class:"form-select"},We,512),[[C,e.selectedTaskStatus]]),y(s("input",{"onUpdate:modelValue":t[9]||(t[9]=o=>e.newTaskMapper=o),class:"form-control",type:"text",placeholder:"mapper name or osu! ID...",onKeyup:t[10]||(t[10]=G(o=>e.addTempTask(o),["enter"]))},null,544),[[D,e.newTaskMapper]]),y((n(),l("button",{class:"btn btn-outline-info",onClick:t[11]||(t[11]=o=>e.addTempTask(o))},Ye)),[[b,"add difficulty"]])]),s("div",ze,[s("ul",Je,[Xe,Ze,xe,e.selectedMode=="taiko"?(n(),l("li",et,' "Hitsounds" cannot be added to osu!taiko. ')):k("",!0)])])]),tt,st,s("div",at,[s("div",ot,[(n(!0),l($,null,B(e.filteredTasks,o=>(n(),l("div",{key:o,class:"form-check"},[y(s("input",{id:`lock-${o}`,"onUpdate:modelValue":t[12]||(t[12]=v=>e.checkedLocks=v),class:"form-check-input",type:"checkbox",value:o},null,8,it),[[R,e.checkedLocks]]),s("label",{class:"form-check-label",for:`lock-${o}`},_(o),9,nt)]))),128))])])]),s("button",{type:"submit",class:"btn btn-outline-success w-100",onClick:t[13]||(t[13]=o=>e.saveNewMap(o))}," Create beatmap "),lt,s("div",dt,[s("div",rt,[f(" Note that you can only earn points for beatmaps that fit these requirements: "),s("ul",null,[s("li",null,[f("Your beatmap was ranked "),ut,f(" you joined the Mappers' Guild ("),s("code",null,_(e.loggedInUser.createdAt),1),f(") and after your guest difficulty creators joined")]),ct,pt,mt])])])]),_:1})}const ft=S(oe,[["render",ht],["__scopeId","data-v-57c0fa59"]]),_t=T({name:"BeatmapPageFilters",components:{FilterBox:Z,ModeFilters:x},data(){return{statuses:{any:"Any",WIP:"WIP",Done:"Done",Qualified:"Qualified",Ranked:"Ranked"},quests:{any:"Any",none:"None"}}},computed:V("beatmaps",["filterMode","filterValue","filterStatus","filterQuest"]),methods:{...z("beatmaps",["updateFilterValue","updateFilterMode","updateFilterStatus","updateFilterQuest"]),getStatusSortClass(e){return this.filterStatus===e?"sorted":"unsorted"},getQuestSortClass(e){return this.filterQuest===e?"sorted":"unsorted"}}}),bt={class:"container card card-body py-3 mb-2"},gt=s("button",{class:"btn btn-primary",href:"#","data-bs-toggle":"modal","data-bs-target":"#addBeatmap"},[f(" Add beatmap "),s("i",{class:"fas fa-plus fa-xs"})],-1),kt={class:"row mt-3"},yt=s("div",{class:"col-auto filter-title"}," Status ",-1),Bt={class:"col"},$t=["onClick"],vt={class:"row mt-3"},wt=s("div",{class:"col-auto filter-title"}," Quest ",-1),Mt={class:"col"},Tt=["onClick"];function St(e,t,a,i,r,g){const c=u("mode-filters"),p=u("filter-box");return n(),l("div",bt,[h(p,{placeholder:"enter to search for song/username...","filter-value":e.filterValue,"onUpdate:filterValue":t[1]||(t[1]=m=>e.updateFilterValue(m))},{filters:L(()=>[h(c,{"filter-mode":e.filterMode,"onUpdate:filterMode":t[0]||(t[0]=m=>e.updateFilterMode(m))},null,8,["filter-mode"]),s("div",kt,[yt,s("div",Bt,[(n(!0),l($,null,B(e.statuses,(m,b)=>(n(),l("a",{key:b,href:"#",class:M(["status",e.getStatusSortClass(b)]),onClick:A(o=>e.updateFilterStatus(b),["prevent"])},_(m),11,$t))),128))])]),s("div",vt,[wt,s("div",Mt,[(n(!0),l($,null,B(e.quests,(m,b)=>(n(),l("a",{key:b,href:"#",class:M(["quest",e.getQuestSortClass(b)]),onClick:A(o=>e.updateFilterQuest(b),["prevent"])},_(m),11,Tt))),128))])])]),default:L(()=>[gt]),_:1},8,["filter-value"])])}const Lt=S(_t,[["render",St]]),Ct=T({components:{BeatmapCard:P},computed:q("beatmaps",["hostedBeatmaps"]),methods:H("beatmaps",["setSelectedBeatmap"])}),It={class:"container card card-body py-3"},Ft={class:"ms-2"},Ot={href:"#hostedBeatmaps","data-bs-toggle":"collapse"},Vt=s("i",{class:"fas fa-angle-down"},null,-1),At={key:0,id:"hostedBeatmaps",class:"show"},Ut={key:0,class:"ms-5 text-secondary"};function Dt(e,t,a,i,r,g){const c=u("beatmap-card");return n(),l("div",It,[s("h5",Ft,[s("a",Ot,[f(" My mapsets ("+_(e.hostedBeatmaps?e.hostedBeatmaps.length:"...")+") ",1),Vt])]),e.hostedBeatmaps?(n(),l("div",At,[h(U,{name:"list",tag:"div",class:"row"},{default:L(()=>[(n(!0),l($,null,B(e.hostedBeatmaps,p=>(n(),I(c,{key:p.id,beatmap:p,"onUpdate:selectedBeatmap":t[0]||(t[0]=m=>e.setSelectedBeatmap(m))},null,8,["beatmap"]))),128))]),_:1}),e.hostedBeatmaps.length?k("",!0):(n(),l("p",Ut," None... "))])):k("",!0)])}const Gt=S(Ct,[["render",Dt]]),Nt=T({components:{BeatmapCard:P},props:{isLoadingGuestBeatmaps:Boolean},computed:q("beatmaps",["guestDifficultyBeatmaps"]),methods:H("beatmaps",["setSelectedBeatmap"])}),Qt={class:"container card card-body py-3"},qt={class:"ms-2"},Ht={href:"#guestDifficultyBeatmaps","data-bs-toggle":"collapse"},Pt=s("i",{class:"fas fa-angle-down"},null,-1),Et={key:0,class:"ms-5 text-secondary"};function jt(e,t,a,i,r,g){const c=u("beatmap-card");return n(),l("div",Qt,[s("h5",qt,[s("a",Ht,[f(" My guest difficulties ("+_(e.guestDifficultyBeatmaps&&!e.isLoadingGuestBeatmaps?e.guestDifficultyBeatmaps.length:"...")+") ",1),Pt])]),e.guestDifficultyBeatmaps?(n(),l("div",{key:0,id:"guestDifficultyBeatmaps",class:M(["collapse",{"loading-data":e.isLoadingGuestBeatmaps}])},[!e.guestDifficultyBeatmaps.length&&!e.isLoadingGuestBeatmaps?(n(),l("p",Et," None... ")):k("",!0),h(U,{name:"list",tag:"div",class:"row"},{default:L(()=>[(n(!0),l($,null,B(e.guestDifficultyBeatmaps,p=>(n(),I(c,{key:p.id,beatmap:p,"onUpdate:selectedBeatmap":t[0]||(t[0]=m=>e.setSelectedBeatmap(m))},null,8,["beatmap"]))),128))]),_:1})],2)):k("",!0)])}const Rt=S(Nt,[["render",jt]]),Wt=T({name:"BeatmapTableRow",components:{BeatmapInfo:ee,ProcessTasks:te,QuestImg:se,ModesIcons:Q},props:{beatmap:{type:Object,required:!0}},methods:{selectBeatmap(){this.$route.query.id!==this.beatmap.id&&this.$router.push(`/beatmaps?id=${this.beatmap.id}`)},formatMetadata(){return this.beatmap.song.artist+" - "+this.beatmap.song.title},statusBorder(){return this.beatmap.status?"card-status-"+this.beatmap.status.toLowerCase():""}}}),Kt={class:"container"},Yt={class:"row"},zt={class:"col-sm-6"},Jt=["data-bs-target"],Xt=s("i",{class:"fas fa-angle-down"},null,-1),Zt={class:"col-sm-2 small d-flex justify-content-end align-items-center"},xt={class:"col-sm-3 small"},es=s("span",{class:"text-secondary me-1"},"Hosted by",-1),ts={key:0,class:"text-secondary"},ss={key:0,class:"col-sm-1 d-flex justify-content-end align-items-center"},as=["href"],os=s("i",{class:"fas fa-link"},null,-1),is=[os],ns=["id"];function ls(e,t,a,i,r,g){const c=u("quest-img"),p=u("process-tasks"),m=u("user-link"),b=u("modes-icons"),o=u("beatmap-info");return n(),l("div",null,[s("div",{class:M(["card card-body card-level-2 my-1 p-1",e.statusBorder()])},[s("div",Kt,[s("div",Yt,[s("div",zt,[h(c,{beatmap:e.beatmap},null,8,["beatmap"]),s("a",{href:"#","data-bs-toggle":"collapse","data-bs-target":"#details"+e.beatmap.id,class:"text-truncate",onClick:t[0]||(t[0]=v=>e.selectBeatmap())},[f(_(e.formatMetadata())+" ",1),Xt],8,Jt)]),s("div",Zt,[h(p,{tasks:e.beatmap.tasks,"tasks-locked":e.beatmap.tasksLocked,mode:e.beatmap.mode},null,8,["tasks","tasks-locked","mode"])]),s("div",xt,[es,h(m,{class:"me-1",user:e.beatmap.host},null,8,["user"]),e.beatmap.mode!=="osu"?(n(),l("span",ts,[h(b,{modes:[e.beatmap.mode],color:"secondary"},null,8,["modes"])])):k("",!0)]),e.beatmap.url?(n(),l("div",ss,[s("a",{href:e.beatmap.url,target:"_blank"},is,8,as)])):k("",!0)])])],2),s("div",{id:"details"+e.beatmap.id,class:M(["collapse my-2 mx-4 row border-end border-start py-3","border-"+e.beatmap.status.toLowerCase()])},[h(o,{beatmap:e.beatmap},null,8,["beatmap"])],10,ns)])}const ds=S(Wt,[["render",ls]]),rs=T({components:{BeatmapTableRow:ds},computed:V("beatmaps",{otherBeatmaps:"allBeatmaps",isLoadingOtherBeatmaps:"isLoadingOtherBeatmaps",filterValue:"filterValue"}),methods:{async showMore(e){e.target.disabled=!0,this.$store.commit("beatmaps/increaseFetchLimit"),await this.$store.dispatch("beatmaps/loadOtherBeatmaps"),e.target.disabled=!1}}}),us={class:"container card card-body py-3"},cs={class:"ms-2"},ps={href:"#otherBeatmaps","data-bs-toggle":"collapse"},ms=s("i",{class:"fas fa-angle-down"},null,-1),hs={key:0,id:"otherBeatmaps",class:"collapse"},fs={key:0,class:"ms-5 text-secondary"},_s={key:1,class:"text-center"},bs=s("i",{class:"fas fa-angle-down me-1"},null,-1),gs=s("i",{class:"fas fa-angle-down ms-1"},null,-1);function ks(e,t,a,i,r,g){const c=u("beatmap-table-row");return n(),l("div",us,[s("h5",cs,[s("a",ps,[f(" Other beatmaps ("+_(e.otherBeatmaps&&!e.isLoadingOtherBeatmaps?e.otherBeatmaps.length:"...")+") ",1),ms])]),e.otherBeatmaps?(n(),l("div",hs,[s("div",{class:M({"loading-data":e.isLoadingOtherBeatmaps})},[!e.otherBeatmaps.length&&!e.isLoadingOtherBeatmaps?(n(),l("p",fs," None... ")):k("",!0),(n(!0),l($,null,B(e.otherBeatmaps,p=>(n(),I(c,{key:p.id,beatmap:p},null,8,["beatmap"]))),128)),e.filterValue?k("",!0):(n(),l("div",_s,[s("button",{class:"btn btn-sm btn-outline-info my-4",onClick:t[0]||(t[0]=A(p=>e.showMore(p),["prevent"]))},[bs,f(" show more "),gs])]))],2)])):k("",!0)])}const ys=S(rs,[["render",ks]]),Bs={namespaced:!0,state:{allBeatmaps:[],userBeatmaps:[],filterValue:"",filterMode:N.any,filterStatus:"any",filterQuest:"any",selectedBeatmap:null,selectedBeatmapId:null,fetchLimit:30,isLoadingOtherBeatmaps:!0},mutations:{setAllBeatmaps(e,t){e.allBeatmaps=t},setUserBeatmaps(e,t){e.userBeatmaps=t},setFilterValue(e,t){e.filterValue=t},setFilterMode(e,t){e.filterMode=t},setFilterStatus(e,t){e.filterStatus=t},setFilterQuest(e,t){e.filterQuest=t},setIsLoadingOtherBeatmaps(e,t){e.isLoadingOtherBeatmaps=t},increaseFetchLimit(e){e.fetchLimit+=50},setSelectedBeatmap(e,t){const a=Object.values(w);t.tasks.sort(function(i,r){return a.indexOf(i.name)-a.indexOf(r.name)}),t.tasksLocked.sort(function(i,r){return a.indexOf(i)-a.indexOf(r)}),e.selectedBeatmap=t},addBeatmap(e,t){e.userBeatmaps.unshift(t)},updateBeatmap(e,t){let a=e.allBeatmaps.findIndex(i=>i.id===t.id);a!==-1&&(e.allBeatmaps[a]=t),a=e.userBeatmaps.findIndex(i=>i.id===t.id),a!==-1&&(e.userBeatmaps[a]=t)},deleteBeatmap(e,t){let a=e.allBeatmaps.findIndex(i=>i.id===t.id);a!==-1&&e.allBeatmaps.splice(a,1),a=e.userBeatmaps.findIndex(i=>i.id===t.id),a!==-1&&e.userBeatmaps.splice(a,1)}},getters:{filteredUserBeatmaps:e=>{let t=e.userBeatmaps;if(e.filterMode!==N.any){const a=e.filterMode;t=t.filter(i=>i.mode===a||i.mode===O.Hybrid)}if(e.filterStatus!=="any"&&(t=t.filter(a=>a.status===e.filterStatus)),e.filterQuest!=="any"&&(t=t.filter(a=>!a.quest)),e.filterValue){const a=e.filterValue.toLowerCase().trim().split(" ").filter(i=>i.length);t=t.filter(i=>{let r=i.song.artist+" "+i.song.title+" "+i.host.username+" "+i.url;return i.tasks.forEach(g=>{g.mappers.forEach(c=>{r+=" "+c.username})}),r=r.toLowerCase(),a.some(g=>r.includes(g))})}return t},guestDifficultyBeatmaps:(e,t,a)=>t.filteredUserBeatmaps.filter(i=>{var r;return i.host.id!==((r=a.loggedInUser)==null?void 0:r.id)}),hostedBeatmaps:(e,t,a)=>t.filteredUserBeatmaps.filter(i=>{var r;return i.host.id===((r=a.loggedInUser)==null?void 0:r.id)})},actions:{updateBeatmap({commit:e,state:t},a){var i;e("updateBeatmap",a),((i=t.selectedBeatmap)==null?void 0:i.id)===a.id&&e("setSelectedBeatmap",a)},async updateFilterMode({commit:e,dispatch:t},a){e("setFilterMode",a),await t("loadOtherBeatmaps")},async updateFilterStatus({commit:e,dispatch:t},a){e("setFilterStatus",a),await t("loadOtherBeatmaps")},async updateFilterQuest({commit:e,dispatch:t},a){e("setFilterQuest",a),await t("loadOtherBeatmaps")},async updateFilterValue({commit:e,dispatch:t},a){e("setFilterValue",a),await t("loadOtherBeatmaps")},async loadOtherBeatmaps({commit:e,state:t}){var c;e("setIsLoadingOtherBeatmaps",!0);const a=t.filterStatus!=="any"?`&status=${t.filterStatus}`:"",i=t.filterQuest!=="any"?`&quest=${t.filterQuest}`:"",r=t.filterValue?`&search=${t.filterValue}`:"",g=await J.get(`/api/beatmaps/search?mode=${t.filterMode}&limit=${t.fetchLimit+a+i+r}`);(c=g.data)!=null&&c.allBeatmaps&&e("setAllBeatmaps",g.data.allBeatmaps),e("setIsLoadingOtherBeatmaps",!1)}}},$s=Bs,vs=T({name:"BeatmapPage",components:{BeatmapPageFilters:Lt,HostedBeatmaps:Gt,GuestDifficulties:Rt,OtherBeatmaps:ys,EditBeatmapModal:ae,CreateBeatmapModal:ft},data(){return{isLoadingGuestBeatmaps:!0}},computed:V("beatmaps",["selectedBeatmap"]),beforeCreate(){this.$store.hasModule("beatmaps")||this.$store.registerModule("beatmaps",$s)},async created(){const e=this.$route.query.id;let t,a;e?([t,a]=await Promise.all([this.$http.initialRequest("/beatmaps/relevantInfo"),this.$http.executeGet("/beatmaps/searchOnLoad/"+e)]),this.$http.isError(a)||(this.$store.commit("beatmaps/setSelectedBeatmap",a),this.$bs.showModal("editBeatmap"))):t=await this.$http.initialRequest("/beatmaps/relevantInfo"),this.$http.isError(t)||(this.$store.commit("beatmaps/setUserBeatmaps",t.beatmaps),this.$store.commit("beatmaps/setFilterMode",t.mainMode)),await Promise.all([this.loadGuestBeatmaps(),this.$store.dispatch("beatmaps/loadOtherBeatmaps")]),this.isLoadingGuestBeatmaps=!1},methods:{async loadGuestBeatmaps(){const e=await this.$http.executeGet("/beatmaps/guestBeatmaps");e&&this.$store.commit("beatmaps/setUserBeatmaps",e.userBeatmaps)}}}),ws=s("div",{class:"radial-divisor"},null,-1),Ms=s("div",{class:"radial-divisor"},null,-1);function Ts(e,t,a,i,r,g){const c=u("beatmap-page-filters"),p=u("hosted-beatmaps"),m=u("guest-difficulties"),b=u("other-beatmaps"),o=u("edit-beatmap-modal"),v=u("create-beatmap-modal");return n(),l("div",null,[h(c),h(p),ws,h(m,{"is-loading-guest-beatmaps":e.isLoadingGuestBeatmaps},null,8,["is-loading-guest-beatmaps"]),Ms,h(b),h(o,{"selected-beatmap":e.selectedBeatmap},null,8,["selected-beatmap"]),h(v)])}const Vs=S(vs,[["render",Ts]]);export{Vs as default};
