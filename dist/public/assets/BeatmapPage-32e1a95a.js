import{d as v,_ as y,o as n,e as l,a,b as A,f as S,i as m,w as p,F as h,r as f,j as B,t as d,k as b,q as _,g as D,z as g,n as $,M as N,m as U,c as w}from"./index-fe01c0c0.js";import{C as M}from"./CopyPaste-92b15a82.js";import{B as E}from"./BeatmapInfoAdmin-bac2c9d8.js";import{D as G}from"./DataTable-78440ecf.js";import"./ModalDialog-aa32fc15.js";import"./TasksChoice-993dcc38.js";const L=v({name:"ContributorStats",components:{CopyPaste:M},data(){return{date:"2022-07-24",externalBeatmaps:[],users:[]}},methods:{async loadNewsInfo(t){const s=await this.$http.executeGet("/admin/beatmaps/loadNewsInfo/"+this.date,t);s&&(this.users=s.users)},separateCommas(t,s){return t<s-1?", ":""}}}),V={class:"container card card-body py-3 mt-2"},P=a("h5",null,"Mappers' Guild contributor stats",-1),R={class:"form-inline"},Y={class:"form-group"},j={key:0},z=a("p",null," Users with ranked maps/tasks: ",-1),H=a("div",null," | User | Modes | Ranked beatmaps | Ranked difficulties | ",-1),K=a("div",null," | :-- | :-- | :-- | :-- | ",-1);function q(t,s,o,i,k,I){const u=_("copy-paste");return n(),l("div",V,[P,a("div",R,[a("div",Y,[a("button",{class:"btn btn-sm btn-info",onClick:s[0]||(s[0]=e=>t.loadNewsInfo(e))}," Generate Mappers' Guild contributors stats "),A(a("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>t.date=e),class:"form-control form-control-sm d-inline mx-2 w-25",type:"text",autocomplete:"off",placeholder:"YYYY-MM-DD"},null,512),[[S,t.date]])])]),t.users&&t.users.length?(n(),l("div",j,[z,m(u,{distinct:"users"},{default:p(()=>[H,K,(n(!0),l(h,null,f(t.users,e=>(n(),l("div",{key:e.id},[B(" | "+d(e.flag)+" ["+d(e.username)+"]("+d("https://osu.ppy.sh/users/"+e.osuId)+") | ",1),(n(!0),l(h,null,f(e.modes,(r,C)=>(n(),l("span",{key:r},d(r=="osu"?"osu!":r=="sb"?"Storyboarder":r=="hs"?"Hitsounder":"osu!"+r)+d(t.separateCommas(C,e.modes.length)),1))),128)),B(" | "+d(e.hostCount)+" | "+d(e.taskCount)+" | ",1)]))),128))]),_:1})])):b("",!0)])}const J=y(L,[["render",q]]),Q=v({name:"OsuApiBeatmapSearch",components:{CopyPaste:M},data(){return{osuId:null,output:null}},methods:{async searchBeatmap(t){const s=await this.$http.executePost("/admin/beatmaps/searchBeatmap",{osuId:this.osuId},t);s&&!s.error&&(this.output=s)}}}),W={class:"container card card-body py-1"},X=a("h5",{class:"mt-2"}," Search beatmap in osu! API ",-1),Z={key:0};function x(t,s,o,i,k,I){const u=_("copy-paste");return n(),l("div",W,[X,A(a("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>t.osuId=e),class:"form-control form-control-sm mb-2",type:"text",maxlength:"18",autocomplete:"off",placeholder:"search by osuID...",onKeyup:s[1]||(s[1]=D(e=>t.searchBeatmap(e),["enter"]))},null,544),[[S,t.osuId]]),a("button",{class:"btn btn-sm w-100 btn-info mb-2",onClick:s[2]||(s[2]=e=>t.searchBeatmap(e))}," Load beatmap "),t.output?(n(),l("div",Z,[m(u,null,{default:p(()=>[a("pre",null,d(t.output),1)]),_:1})])):b("",!0)])}const tt=y(Q,[["render",x]]),et=v({name:"BundledBeatmapsList",components:{CopyPaste:M},data(){return{bundledBeatmaps:[]}},computed:{osuBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="osu")},taikoBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="taiko")},catchBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="catch")},maniaBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="mania")},osuFinalBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="osu"&&t.isBundled)},taikoFinalBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="taiko"&&t.isBundled)},catchFinalBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="catch"&&t.isBundled)},maniaFinalBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="mania"&&t.isBundled)}},methods:{async findBundledBeatmaps(t){const s=await this.$http.executeGet("/admin/beatmaps/findBundledBeatmaps",t);s&&!s.error&&(this.bundledBeatmaps=s)},async toggleIsBundled(t,s){const o=await this.$http.executePost("/admin/beatmaps/"+t+"/toggleIsBundled",{isBundled:s});if(!this.$http.isError(o)){const i=[...this.bundledBeatmaps],k=i.findIndex(I=>I.id==t);i[k]=o,this.bundledBeatmaps=i}},findOsuId(t){const s=t.indexOf("beatmapsets/")+12,o=t.indexOf("#");let i="";return o!==-1?i=t.slice(s,o):i=t.slice(s),parseInt(i,10)}}}),st={class:"container card card-body py-3 mt-2"},at=a("h5",null,"Bundled beatmap list generator",-1),nt={key:0,class:"row mt-3 small"},ot={class:"col-sm-6"},dt=["onClick"],it=["href"],lt={class:"col-sm-6"},rt=["onClick"],ut=["href"],ct={class:"col-sm-6"},mt=["onClick"],pt=["href"],ht={class:"col-sm-6"},ft=["onClick"],Bt=["href"],_t=a("p",null,"final lists",-1),kt={class:"row"},gt={class:"col-sm-3"},$t=["href"],bt=["onClick"],It={class:"col-sm-3"},vt=["href"],yt=["onClick"],Ct={class:"col-sm-3"},wt=["href"],Mt=["onClick"],At={class:"col-sm-3"},St=["href"],Ft=["onClick"];function Ot(t,s,o,i,k,I){const u=_("copy-paste");return n(),l("div",st,[at,a("button",{class:"btn btn-sm w-100 btn-info",onClick:s[0]||(s[0]=e=>t.findBundledBeatmaps(e))}," Load beatmaps with ENHI+ spreads "),t.bundledBeatmaps.length?(n(),l("div",nt,[a("div",ot,[B(" osu ("+d(t.osuBeatmaps.length)+") ",1),m(u,{distinct:"osu"},{default:p(()=>[(n(!0),l(h,null,f(t.osuBeatmaps,e=>(n(),l("div",{key:e.id},[a("a",{href:"#",class:"me-1",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[a("i",{class:$(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,dt),a("a",{href:e.url,target:"_blank"},d(e.song.artist+" - "+e.song.title)+" ("+d(t.findOsuId(e.url))+")",9,it)]))),128))]),_:1})]),a("div",lt,[B(" taiko ("+d(t.taikoBeatmaps.length)+") ",1),m(u,{distinct:"taiko"},{default:p(()=>[(n(!0),l(h,null,f(t.taikoBeatmaps,e=>(n(),l("div",{key:e.id},[a("a",{href:"#",class:"me-1",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[a("i",{class:$(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,rt),a("a",{href:e.url,target:"_blank"},d(e.song.artist+" - "+e.song.title)+" ("+d(t.findOsuId(e.url))+")",9,ut)]))),128))]),_:1})]),a("div",ct,[B(" catch ("+d(t.catchBeatmaps.length)+") ",1),m(u,{distinct:"catch"},{default:p(()=>[(n(!0),l(h,null,f(t.catchBeatmaps,e=>(n(),l("div",{key:e.id},[a("a",{href:"#",class:"me-1",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[a("i",{class:$(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,mt),a("a",{href:e.url,target:"_blank"},d(e.song.artist+" - "+e.song.title)+" ("+d(t.findOsuId(e.url))+")",9,pt)]))),128))]),_:1})]),a("div",ht,[B(" mania ("+d(t.maniaBeatmaps.length)+") ",1),m(u,{distinct:"mania"},{default:p(()=>[(n(!0),l(h,null,f(t.maniaBeatmaps,e=>(n(),l("div",{key:e.id},[a("a",{href:"#",class:"me-1",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[a("i",{class:$(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,ft),a("a",{href:e.url,target:"_blank"},d(e.song.artist+" - "+e.song.title)+" ("+d(t.findOsuId(e.url))+")",9,Bt)]))),128))]),_:1})]),_t,a("div",kt,[a("div",gt,[B(" osu ("+d(t.osuFinalBeatmaps.length)+") ",1),m(u,{distinct:"osufinal"},{default:p(()=>[(n(!0),l(h,null,f(t.osuFinalBeatmaps,e=>(n(),l("div",{key:e.id},[a("a",{href:e.url,target:"_blank",class:"me-1"},d(t.findOsuId(e.url)),9,$t),a("a",{href:"#",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[a("i",{class:$(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,bt)]))),128))]),_:1})]),a("div",It,[B(" taiko ("+d(t.taikoFinalBeatmaps.length)+") ",1),m(u,{distinct:"taiko"},{default:p(()=>[(n(!0),l(h,null,f(t.taikoFinalBeatmaps,e=>(n(),l("div",{key:e.id},[a("a",{href:e.url,target:"_blank",class:"me-1"},d(t.findOsuId(e.url)),9,vt),a("a",{href:"#",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[a("i",{class:$(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,yt)]))),128))]),_:1})]),a("div",Ct,[B(" catch ("+d(t.catchFinalBeatmaps.length)+") ",1),m(u,{distinct:"catch"},{default:p(()=>[(n(!0),l(h,null,f(t.catchFinalBeatmaps,e=>(n(),l("div",{key:e.id},[a("a",{href:e.url,target:"_blank",class:"me-1"},d(t.findOsuId(e.url)),9,wt),a("a",{href:"#",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[a("i",{class:$(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,Mt)]))),128))]),_:1})]),a("div",At,[B(" mania ("+d(t.maniaFinalBeatmaps.length)+") ",1),m(u,{distinct:"mania"},{default:p(()=>[(n(!0),l(h,null,f(t.maniaFinalBeatmaps,e=>(n(),l("div",{key:e.id},[a("a",{href:e.url,target:"_blank",class:"me-1"},d(t.findOsuId(e.url)),9,St),a("a",{href:"#",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[a("i",{class:$(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,Ft)]))),128))]),_:1})])])])):b("",!0)])}const Tt=y(et,[["render",Ot]]),Dt={state:{beatmaps:[]},mutations:{setBeatmaps(t,s){t.beatmaps=s},updateBeatmap(t,s){const o=t.beatmaps.findIndex(i=>i.id===s.id);o!==-1&&(t.beatmaps[o]=s)},updateBeatmapStatus(t,s){const o=t.beatmaps.find(i=>i.id==s.beatmapId);o&&(o.status=s.status)},deleteTask(t,s){const o=t.beatmaps.find(i=>i.id==s.beatmapId);if(o){const i=o.tasks.findIndex(k=>k.id==s.taskId);i!==-1&&o.tasks.splice(i,1)}},deleteModder(t,s){const o=t.beatmaps.find(i=>i.id==s.beatmapId);if(o){const i=o.modders.findIndex(k=>k.id==s.modderId);i!==-1&&o.modders.splice(i,1)}},updateUrl(t,s){const o=t.beatmaps.find(i=>i.id==s.beatmapId);o&&(o.url=s.url)},updateIsShowcase(t,s){const o=t.beatmaps.find(i=>i.id==s.beatmapId);o&&(o.isShowcase=s.isShowcase)}}},Nt=Dt,Ut=v({components:{ContributorStats:J,DataTable:G,BeatmapInfoAdmin:E,OsuApiBeatmapSearch:tt,BundledBeatmapsList:Tt,ModesIcons:N},data(){return{selectedBeatmapId:""}},computed:{...U({beatmaps:t=>t.beatmapsAdmin.beatmaps}),selectedBeatmap(){return this.beatmaps.find(t=>t.id===this.selectedBeatmapId)}},beforeCreate(){this.$store.hasModule("beatmapsAdmin")||this.$store.registerModule("beatmapsAdmin",Nt)},unmounted(){this.$store.hasModule("beatmapsAdmin")&&this.$store.unregisterModule("beatmapsAdmin")},methods:{async loadBeatmaps(t){const s=await this.$http.executeGet("/admin/beatmaps/load",t);this.$http.isError(s)||this.$store.commit("setBeatmaps",s)},updateBeatmap(t){const s=this.beatmaps.findIndex(o=>o.id==t.id);s!==-1&&(this.beatmaps[s]=t)},formatMetadata(t){if(!t)return"";let s=t.artist+" - ";return t.title.length>40?s+=t.title.slice(0,40)+"...":s+=t.title,s}}}),Et={class:"container card card-body py-3"},Gt=a("h5",null,"Beatmaps list",-1),Lt={class:"text-truncate"},Vt=["href"],Pt={key:1,class:"ms-1"};function Rt(t,s,o,i,k,I){const u=_("modes-icons"),e=_("user-link"),r=_("data-table"),C=_("beatmap-info-admin"),F=_("osu-api-beatmap-search"),O=_("contributor-stats"),T=_("bundled-beatmaps-list");return n(),l("div",null,[a("div",Et,[Gt,a("button",{class:"btn btn-sm btn-info w-100",onClick:s[0]||(s[0]=c=>t.loadBeatmaps(c))}," Load all beatmaps "),t.beatmaps.length?(n(),w(r,{key:0,data:t.beatmaps,headers:["METADATA","CREATOR","STATUS"],"custom-data-target":"#editBeatmap","onUpdate:selectedId":s[1]||(s[1]=c=>t.selectedBeatmapId=c)},{default:p(({obj:c})=>[a("td",Lt,[m(u,{modes:[c.mode]},null,8,["modes"]),c.url?(n(),l("a",{key:0,href:c.url,class:"ms-1"},d(t.formatMetadata(c.song)),9,Vt)):(n(),l("span",Pt,d(t.formatMetadata(c.song)),1))]),a("td",null,[c.host?(n(),w(e,{key:0,user:c.host},null,8,["user"])):b("",!0)]),a("td",null,d(c.status),1)]),_:1},8,["data"])):b("",!0)]),t.selectedBeatmap?(n(),w(C,{key:0,beatmap:t.selectedBeatmap,onUpdateBeatmap:s[2]||(s[2]=c=>t.updateBeatmap(c))},null,8,["beatmap"])):b("",!0),m(F,{class:"mt-2"}),m(O),m(T)])}const Jt=y(Ut,[["render",Rt]]);export{Jt as default};
