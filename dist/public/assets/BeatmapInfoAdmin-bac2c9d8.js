import{M as v}from"./ModalDialog-aa32fc15.js";import{d as S,M as T,S as M,_,o as i,c as R,w as b,e as n,t as o,j as d,a as s,i as u,b as r,v as h,r as c,F as f,k,f as $,q as l}from"./index-fe01c0c0.js";import{T as B}from"./TasksChoice-993dcc38.js";const U=S({name:"BeatmapInfoAdmin",components:{ModalDialog:v,ModesIcons:T,TasksChoice:B},props:{beatmap:{type:Object,required:!0}},data(){return{status:this.beatmap.status,taskId:null,modderId:null,beatmapUrl:this.beatmap.url,rejectionInput:""}},computed:{sortedTasks(){const t=M;return[...this.beatmap.tasks].sort(function(e,p){return t.indexOf(e.name)-t.indexOf(p.name)})}},watch:{beatmap(){this.findBeatmapInfo()}},mounted(){this.findBeatmapInfo()},methods:{findBeatmapInfo(){this.status=this.beatmap.status,this.taskId=null,this.modderId=null,this.beatmapUrl=this.beatmap.url,this.rejectionInput=""},findTaskInfo(t){let e=`${t.name} --- `;const p=t.mappers.map(m=>m.username);return e+=p.join(", "),e},async updateBeatmapStatus(t){const e=await this.$http.executePost(`/admin/beatmaps/${this.beatmap.id}/updateStatus`,{status:this.status},t);this.$http.isError(e)||(this.$store.dispatch("updateToastMessages",{message:"updated beatmap status",type:"info"}),this.$store.commit("updateBeatmapStatus",{beatmapId:this.beatmap.id,status:e}))},async deleteTask(t){const e=await this.$http.executePost(`/admin/beatmaps/${this.beatmap.id}/tasks/${this.taskId}/delete`,{},t);this.$http.isError(e)||(this.$store.dispatch("updateToastMessages",{message:"deleted task",type:"info"}),this.$store.commit("deleteTask",{beatmapId:this.beatmap.id,taskId:this.taskId}))},async deleteModder(t){const e=await this.$http.executePost(`/admin/beatmaps/${this.beatmap.id}/modders/${this.modderId}/delete`,{},t);this.$http.isError(e)||(this.$store.dispatch("updateToastMessages",{message:"deleted modder",type:"info"}),this.$store.commit("deleteModder",{beatmapId:this.beatmap.id,modderId:this.modderId}))},async updateUrl(t){const e=await this.$http.executePost(`/admin/beatmaps/${this.beatmap.id}/updateUrl`,{url:this.beatmapUrl},t);this.$http.isError(e)||(this.$store.dispatch("updateToastMessages",{message:"updated URL",type:"info"}),this.$store.commit("updateUrl",{beatmapId:this.beatmap.id,url:e}))},async updateIsShowcase(t){const e=await this.$http.executePost(`/admin/beatmaps/${this.beatmap.id}/updateIsShowcase`,{isShowcase:!this.beatmap.isShowcase},t);this.$http.isError(e)||(this.$store.dispatch("updateToastMessages",{message:`updated isShowcase: ${e}`,type:"info"}),this.$store.commit("updateIsShowcase",{beatmapId:this.beatmap.id,isShowcase:e}))},async updateQueuedForRank(t){const e=await this.$http.executePost(`/admin/beatmaps/${this.beatmap.id}/updateQueuedForRank`,{queuedForRank:!this.beatmap.queuedForRank},t);this.$http.isError(e)||(this.$store.dispatch("updateToastMessages",{message:`updated queuedForRank: ${e}`,type:"info"}),this.$store.commit("updateQueuedForRank",{beatmapId:this.beatmap.id,queuedForRank:e}))},async updateSkipWebhook(t){const e=await this.$http.executePost(`/admin/beatmaps/${this.beatmap.id}/updateSkipWebhook`,{skipWebhook:!this.beatmap.skipWebhook},t);this.$http.isError(e)||(this.$store.dispatch("updateToastMessages",{message:`updated skipWebhook: ${e}`,type:"info"}),this.$store.commit("updateSkipBeatmapWebhook",{beatmapId:this.beatmap.id,skipWebhook:e}))},async rejectMapset(t,e){if(confirm("Are you sure?")){const m=await this.$http.executePost(`/admin/beatmaps/${this.beatmap.id}/rejectMapset`,{messages:this.rejectionInput,isResolvable:e},t);this.$http.isError(m)||(this.$store.dispatch("updateToastMessages",{message:"updated beatmap status",type:"info"}),this.$store.commit("updateBeatmapStatus",{beatmapId:this.beatmap.id,status:m}))}}}}),j=["href"],C={key:1},F=["href"],W={class:"container"},P={class:"row"},E={class:"row"},V=["value"],q=s("hr",null,null,-1),Q={key:0},D={key:0,class:"mb-2 small"},A={class:"text-secondary"},N={class:"text-secondary"},O={class:"row mb-2"},L={class:"col-sm-6"},G={class:"text-danger me-2"},H={class:"row mb-2"},z={class:"col-sm-6"},J={class:"text-danger me-2"},K={class:"row"},X=s("hr",null,null,-1),Y={class:"row mb-2"},Z=s("option",{value:"WIP"}," WIP ",-1),x=s("option",{value:"Done"}," Done ",-1),tt=s("option",{value:"Qualified"}," Qualified ",-1),et=s("option",{value:"Ranked"}," Ranked ",-1),st=[Z,x,tt,et],at={class:"row mb-2"},ot=["value"],it={class:"row mb-2"},nt={class:"row mb-2"},dt={class:"col-sm-6"},pt={class:"text-danger me-2"};function mt(t,e,p,m,rt,lt){const w=l("user-link"),g=l("modes-icons"),I=l("tasks-choice"),y=l("modal-dialog");return i(),R(y,{id:"editBeatmap",loaded:!!t.beatmap},{header:b(()=>[t.beatmap.url?(i(),n("a",{key:0,href:t.beatmap.url,target:"_blank"},o(t.beatmap.song.artist)+" - "+o(t.beatmap.song.title),9,j)):(i(),n("span",C,o(t.beatmap.song.artist)+" - "+o(t.beatmap.song.title),1)),d(" | "),s("a",{href:`/beatmaps?id=${t.beatmap.id}`,target:"_blank"},"MG url",8,F),d(" | "),u(w,{class:"me-1",user:t.beatmap.host},null,8,["user"]),u(g,{modes:[t.beatmap.mode],color:"dark"},null,8,["modes"])]),default:b(()=>[s("div",W,[s("div",P,[u(I,{beatmap:t.beatmap,"is-host":!0,"is-qualified":!1,"is-ranked":!1,"is-admin":!0},null,8,["beatmap"])]),s("p",E,[r(s("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>t.taskId=a),class:"form-select form-select-sm w-50 mx-2"},[(i(!0),n(f,null,c(t.sortedTasks,a=>(i(),n("option",{key:a.id,value:a.id},o(t.findTaskInfo(a)),9,V))),128))],512),[[h,t.taskId]]),s("button",{class:"btn btn-sm btn-outline-danger w-25",onClick:e[1]||(e[1]=a=>t.deleteTask(a))}," Remove difficulty ")]),q,t.beatmap.status=="Qualified"?(i(),n("span",Q,[t.beatmap.rankedDate?(i(),n("div",D,[s("ul",null,[s("li",null,[d("Host join date: "),s("span",A,o(t.beatmap.host.createdAt),1)]),s("li",null,[d("Ranked: "),s("span",N,o(t.beatmap.rankedDate),1)])])])):k("",!0),s("div",O,[s("span",L,[d(" Queued for rank: "),s("span",G,o(t.beatmap.queuedForRank?"true":"false"),1)]),s("button",{class:"btn btn-sm btn-outline-info ms-3 w-25",onClick:e[2]||(e[2]=a=>t.updateQueuedForRank(a))}," Toggle ")]),s("div",H,[s("span",z,[d(" Skip webhook: "),s("span",J,o(t.beatmap.skipWebhook?"true":"false"),1)]),s("button",{class:"btn btn-sm btn-outline-info ms-3 w-25",onClick:e[3]||(e[3]=a=>t.updateSkipWebhook(a))}," Toggle ")]),s("p",K,[r(s("textarea",{"onUpdate:modelValue":e[4]||(e[4]=a=>t.rejectionInput=a),class:"form-control form-control-sm w-25",type:"text",autocomplete:"off",placeholder:"message...",rows:"1"},null,512),[[$,t.rejectionInput]]),s("button",{class:"btn btn-sm btn-outline-info ms-2 w-25",onClick:e[5]||(e[5]=a=>t.rejectMapset(a,!0))}," Reject with resolution "),s("button",{class:"btn btn-sm btn-outline-danger ms-2 w-25",onClick:e[6]||(e[6]=a=>t.rejectMapset(a,!1))}," Reject without resolution ")]),X])):k("",!0),s("div",Y,[r(s("select",{"onUpdate:modelValue":e[7]||(e[7]=a=>t.status=a),class:"form-select form-select-sm w-50 mx-2"},st,512),[[h,t.status]]),s("button",{class:"btn btn-sm btn-outline-info w-25",onClick:e[8]||(e[8]=a=>t.updateBeatmapStatus(a))}," Save status ")]),s("div",at,[r(s("select",{"onUpdate:modelValue":e[9]||(e[9]=a=>t.modderId=a),class:"form-select form-select-sm w-50 mx-2"},[(i(!0),n(f,null,c(t.beatmap.modders,a=>(i(),n("option",{key:a.id,value:a.id},o(a.username),9,ot))),128))],512),[[h,t.modderId]]),s("button",{class:"btn btn-sm btn-outline-danger w-25",onClick:e[10]||(e[10]=a=>t.deleteModder(a))}," Remove modder ")]),s("div",it,[r(s("input",{"onUpdate:modelValue":e[11]||(e[11]=a=>t.beatmapUrl=a),class:"form-control form-control-sm mx-2 w-50",type:"text",autocomplete:"off",placeholder:"beatmap url..."},null,512),[[$,t.beatmapUrl]]),s("button",{class:"btn btn-sm btn-outline-info w-25",onClick:e[12]||(e[12]=a=>t.updateUrl(a))}," Save URL ")]),s("div",nt,[s("span",dt,[d(" Featured Artist showcase: "),s("span",pt,o(t.beatmap.isShowcase?"true":"false"),1)]),s("button",{class:"btn btn-sm btn-outline-info ms-3 w-25",onClick:e[13]||(e[13]=a=>t.updateIsShowcase(a))}," Toggle ")])])]),_:1},8,["loaded"])}const ct=_(U,[["render",mt]]);export{ct as B};
