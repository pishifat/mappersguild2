import{d as y,U as H,M as V,S as F,m as O,T as C,B as U,_ as B,o as a,c as I,w as q,a as s,b as $,v as P,e as i,r as w,t as m,F as M,f as E,g as D,h as ne,i as k,j as b,k as c,n as v,l as G,p as le,q as f,s as T,u as K,x as Y,y as de,z as L,A,C as N,D as X,E as J,G as W,H as re}from"./index-fe01c0c0.js";import{M as Z}from"./ModalDialog-aa32fc15.js";import{F as ue}from"./FilterBox-e04d89bd.js";import{M as pe,F as z}from"./extras-d70dcad3.js";import{T as ce}from"./TasksChoice-993dcc38.js";const me=y({name:"CreateBeatmapModal",components:{ModalDialog:Z,UserLinkList:H,ModesIcons:V},data(){return{featuredArtists:[],featuredSongs:[],selectedArtist:"",artistInput:"",selectedSong:"",selectedMode:"osu",selectedTaskStatus:"",previousSelectedMode:"",selectedTaskMode:"osu",checkedLocks:[],modes:[{value:"osu",name:"osu!"},{value:"taiko",name:"osu!taiko"},{value:"catch",name:"osu!catch"},{value:"mania",name:"osu!mania"},{value:"hybrid",name:"Multiple modes"}],tasks:F,newTaskName:"",newTaskMapper:"",tempTasks:[]}},computed:{...O(["loggedInUser"]),filteredTasks(){return this.selectedMode=="taiko"?[...F].filter(e=>e!=C.Hitsounds):F},sortedTasks(){const e=F,t=["osu","taiko","catch","mania","hs","sb"];return[...this.tempTasks].sort(function(l,r){return e.indexOf(l.name)-e.indexOf(r.name)}).sort(function(l,r){return t.indexOf(l.mode)-t.indexOf(r.mode)})}},watch:{selectedMode(){if(this.selectedMode==U.Taiko){const e=this.tempTasks.findIndex(t=>t.name==C.Hitsounds);e>=0&&(this.tempTasks.splice(e,1),this.newTaskName="")}this.selectedMode==U.Hybrid&&(this.tempTasks=[]),this.previousSelectedMode==U.Hybrid&&(this.tempTasks=[]),this.previousSelectedMode=this.selectedMode}},async created(){const e=await this.$http.executeGet("/featuredArtists");e&&(this.featuredArtists=e.sort((t,o)=>t.label.toLowerCase()>o.label.toLowerCase()?1:o.label.toLowerCase()>t.label.toLowerCase()?-1:0))},methods:{async setArtist(e){if(!this.selectedArtist&&!this.artistInput){this.$store.dispatch("updateToastMessages",{message:"Select or type an artist!",type:"danger"});return}if(this.artistInput){const o=this.featuredArtists.find(l=>l.label.toLowerCase().includes(this.artistInput.toLowerCase()));o&&(this.selectedArtist=o.id)}if(!this.selectedArtist){this.$store.dispatch("updateToastMessages",{message:"Couldn't find artist! Check your typing or select one from the list.",type:"danger"});return}e.target.disabled=!0;const t=await this.$http.executeGet(`/featuredArtists/${this.selectedArtist}/songs`);t&&(this.featuredSongs=t.sort((o,l)=>o.title.toLowerCase()>l.title.toLowerCase()?1:l.title.toLowerCase()>o.title.toLowerCase()?-1:0)),e.target.disabled=!1},async addTempTask(e){if(!this.newTaskName.length||!this.selectedTaskStatus.length){this.$store.dispatch("updateToastMessages",{message:"Missing task or status",type:"danger"});return}const t=this.tempTasks.find(r=>r.name==C.Hitsounds),o=this.tempTasks.find(r=>r.name==C.Storyboard);if(t&&this.newTaskName==C.Hitsounds){this.$store.dispatch("updateToastMessages",{message:'Only one "Hitsounds" task allowed',type:"danger"});return}if(o&&this.newTaskName==C.Storyboard){this.$store.dispatch("updateToastMessages",{message:'Only one "Storyboard" task allowed',type:"danger"});return}const l=await this.$http.executeGet(`/beatmaps/validateUsers/${this.newTaskMapper.length?this.newTaskMapper:this.loggedInUser.username}`,e);l&&l.length&&this.tempTasks.push({name:this.newTaskName,mappers:l,mode:this.selectedTaskMode,status:this.selectedTaskStatus,random:Math.random().toString()})},removeTempTask(e){const t=this.tempTasks.findIndex(o=>o.random==e);this.tempTasks.splice(t,1)},async saveNewMap(e){if(!this.selectedSong){this.$store.dispatch("updateToastMessages",{message:"Select a song!",type:"info"});return}const t=await this.$http.executePost("/beatmaps/create/",{song:this.selectedSong,tasks:this.tempTasks,tasksLocked:this.checkedLocks,mode:this.selectedMode},e);this.$http.isError(t)||(this.$bs.hideModal("addBeatmap"),this.$store.commit("beatmaps/addBeatmap",t))}}});const _=e=>(K("data-v-57c0fa59"),e=e(),Y(),e),he={class:"container"},fe={class:"mb-3 row"},be=_(()=>s("div",{class:"col-lg-1"},[s("p",{style:{"margin-top":"3px"}}," Artist: ")],-1)),_e={class:"col-lg-11"},ke={id:"artistForm",class:"input-group input-group-sm mb-3"},$e=_(()=>s("option",{value:""}," Select an artist ",-1)),ge=_(()=>s("option",{value:"-",disabled:""}," --- ",-1)),ye=["value"],ve=_(()=>s("div",{class:"col-lg-1"},[s("p",{style:{"margin-top":"3px"}}," Song: ")],-1)),Be={class:"col-lg-11"},we=["disabled"],Me=_(()=>s("option",{value:"",disabled:""}," Select an artist to view songs ",-1)),Ie=_(()=>s("option",{value:"-",disabled:""}," --- ",-1)),Le=["value"],Te=_(()=>s("hr",null,null,-1)),Se=_(()=>s("p",null," Game-mode: ",-1)),Ce={class:"mb-3 row"},Pe={class:"col-sm-10"},qe=["id","value"],Oe=["for"],Ae=_(()=>s("br",null,null,-1)),Ue=_(()=>s("hr",null,null,-1)),Fe=_(()=>s("div",{class:"mb-2"},[b(" Set your mapset's difficulties "),s("div",{class:"small text-secondary"}," These can be changed later. ")],-1)),Qe={key:0,class:"table table-sm"},Ve=_(()=>s("thead",null,[s("tr",null,[s("th",null,"Difficulty"),s("th",null,"Mapper(s)"),s("th",null,"Status"),s("th")])],-1)),Ee={class:"text-secondary"},De=["onClick"],Ne=_(()=>s("i",{class:"fas fa-times"},null,-1)),He=[Ne],Ge={class:"col-sm-12"},je={class:"input-group input-group-sm mx-auto"},Re=_(()=>s("option",{value:"",disabled:"",selected:""}," Select a task ",-1)),We=["value"],ze=_(()=>s("option",{value:"osu"}," osu! ",-1)),Ke=_(()=>s("option",{value:"taiko"}," osu!taiko ",-1)),Ye=_(()=>s("option",{value:"catch"}," osu!catch ",-1)),Xe=_(()=>s("option",{value:"mania"}," osu!mania ",-1)),Je=[ze,Ke,Ye,Xe],Ze=_(()=>s("option",{value:"",disabled:"",selected:""}," Select a status ",-1)),xe=_(()=>s("option",{value:"WIP"}," Work-in-progress ",-1)),et=_(()=>s("option",{value:"Done"}," Done ",-1)),tt=[Ze,xe,et],st=_(()=>s("i",{class:"fas fa-plus"},null,-1)),at=[st],ot={class:"text-secondary small mt-1"},it={class:"small"},nt=_(()=>s("li",null,'You can leave the "mapper" field empty for your own difficulties.',-1)),lt=_(()=>s("li",null,'Use comma separation for collabs, like "mapper1, mapper2".',-1)),dt=_(()=>s("li",null,'There can only be one entry for "Storyboard" and "Hitsounds".',-1)),rt={key:0},ut=_(()=>s("hr",null,null,-1)),pt=_(()=>s("div",{class:"mb-2"},[b(" Set any difficulties that nobody else is allowed to claim. "),s("div",{class:"small text-secondary"}," For example, if you don't want any guest difficulties, you should select all. These can be changed later. ")],-1)),ct={class:"mb-3 row"},mt={class:"col-sm-10"},ht=["id","value"],ft=["for"],bt=_(()=>s("div",{class:"radial-divisor"},null,-1)),_t={class:"small text-secondary mt-2"},kt={class:"small"},$t=_(()=>s("i",null,"after",-1)),gt=_(()=>s("li",null,[b("Your beatmap was ranked "),s("i",null,"after"),b(" the Featured Artist was announced, excluding maps created for the announcement")],-1)),yt=_(()=>s("li",null,"Difficulties match between Mappers' Guild and osu! website (including difficulty levels and mappers)",-1)),vt=_(()=>s("li",null,[s("b",null,"Try to get permission for your map's background."),b(" It's unrealistic (and annoying to mappers) to police all background usage, but if you support the goal of the Mappers' Guild, please use appropriately permitted backgrounds. At minimum, your background should not be AI generated nor contain content from other media franchises (like Mikasa from Attack on Titan), excluding creative commons content (like Hatsune Miku) or content permitted by franchise owners (like Touhou).")],-1));function Bt(e,t,o,l,r,h){const u=f("modes-icons"),n=f("user-link-list"),p=f("modal-dialog"),g=T("bs-tooltip");return a(),I(p,{id:"addBeatmap",title:"Add beatmap"},{default:q(()=>[s("div",he,[s("div",fe,[be,s("div",_e,[s("div",ke,[$(s("select",{"onUpdate:modelValue":t[0]||(t[0]=d=>e.selectedArtist=d),class:"form-select"},[$e,ge,(a(!0),i(M,null,w(e.featuredArtists,d=>(a(),i("option",{key:d.id,value:d.id},m(d.label),9,ye))),128))],512),[[P,e.selectedArtist]]),$(s("input",{"onUpdate:modelValue":t[1]||(t[1]=d=>e.artistInput=d),type:"text",class:"form-control",placeholder:"or input the artist's name...",onKeyup:t[2]||(t[2]=D(d=>e.setArtist(d),["enter"]))},null,544),[[E,e.artistInput]]),s("button",{id:"artistButton",class:"btn btn-outline-info",onClick:t[3]||(t[3]=d=>e.setArtist(d))}," Load songs ")])]),ve,s("div",Be,[$(s("select",{"onUpdate:modelValue":t[4]||(t[4]=d=>e.selectedSong=d),class:"form-select form-select-sm",disabled:!e.featuredSongs.length},[Me,Ie,(a(!0),i(M,null,w(e.featuredSongs,d=>(a(),i("option",{key:d.id,value:d.id},m(d.title)+" --- ("+m(d.artist)+") ",9,Le))),128))],8,we),[[P,e.selectedSong]])])]),Te,Se,s("div",Ce,[s("div",Pe,[(a(!0),i(M,null,w(e.modes,d=>(a(),i("div",{key:d.value,class:"form-check form-check-inline"},[$(s("input",{id:d.value,"onUpdate:modelValue":t[5]||(t[5]=S=>e.selectedMode=S),class:"form-check-input",type:"radio",value:d.value},null,8,qe),[[ne,e.selectedMode]]),s("label",{class:"form-check-label",for:d.value},m(d.name),9,Oe)]))),128)),Ae])]),Ue,Fe,e.tempTasks.length?(a(),i("table",Qe,[Ve,k(G,{tag:"tbody",name:"list"},{default:q(()=>[(a(!0),i(M,null,w(e.tempTasks,d=>(a(),i("tr",{key:d.random},[s("td",Ee,[b(m(d.name)+" ",1),e.selectedMode=="hybrid"?(a(),I(u,{key:0,modes:[d.mode],color:"secondary"},null,8,["modes"])):c("",!0)]),s("td",null,[k(n,{users:d.mappers},null,8,["users"])]),s("td",{class:v(d.status=="WIP"?"text-wip":"text-success")},m(d.status),3),s("td",null,[$((a(),i("a",{href:"#",class:"text-danger",onClick:S=>e.removeTempTask(d.random)},He,8,De)),[[g,"delete"]])])]))),128))]),_:1})])):c("",!0),s("div",Ge,[s("div",je,[$(s("select",{"onUpdate:modelValue":t[6]||(t[6]=d=>e.newTaskName=d),class:"form-select"},[Re,(a(!0),i(M,null,w(e.filteredTasks,d=>(a(),i("option",{key:d,value:d},m(d),9,We))),128))],512),[[P,e.newTaskName]]),e.selectedMode=="hybrid"?$((a(),i("select",{key:0,"onUpdate:modelValue":t[7]||(t[7]=d=>e.selectedTaskMode=d),class:"form-select"},Je,512)),[[P,e.selectedTaskMode]]):c("",!0),$(s("select",{"onUpdate:modelValue":t[8]||(t[8]=d=>e.selectedTaskStatus=d),class:"form-select"},tt,512),[[P,e.selectedTaskStatus]]),$(s("input",{"onUpdate:modelValue":t[9]||(t[9]=d=>e.newTaskMapper=d),class:"form-control",type:"text",placeholder:"mapper name or osu! ID...",onKeyup:t[10]||(t[10]=D(d=>e.addTempTask(d),["enter"]))},null,544),[[E,e.newTaskMapper]]),$((a(),i("button",{class:"btn btn-outline-info",onClick:t[11]||(t[11]=d=>e.addTempTask(d))},at)),[[g,"add difficulty"]])]),s("div",ot,[s("ul",it,[nt,lt,dt,e.selectedMode=="taiko"?(a(),i("li",rt,' "Hitsounds" cannot be added to osu!taiko. ')):c("",!0)])])]),ut,pt,s("div",ct,[s("div",mt,[(a(!0),i(M,null,w(e.filteredTasks,d=>(a(),i("div",{key:d,class:"form-check"},[$(s("input",{id:`lock-${d}`,"onUpdate:modelValue":t[12]||(t[12]=S=>e.checkedLocks=S),class:"form-check-input",type:"checkbox",value:d},null,8,ht),[[le,e.checkedLocks]]),s("label",{class:"form-check-label",for:`lock-${d}`},m(d),9,ft)]))),128))])])]),s("button",{type:"submit",class:"btn btn-outline-success w-100",onClick:t[13]||(t[13]=d=>e.saveNewMap(d))}," Create beatmap "),bt,s("div",_t,[s("div",kt,[b(" Note that you can only earn points for beatmaps that fit these requirements: "),s("ul",null,[s("li",null,[b("Your beatmap was ranked "),$t,b(" you joined the Mappers' Guild ("),s("code",null,m(e.loggedInUser.createdAt),1),b(") and after your guest difficulty creators joined")]),gt,yt,vt])])])]),_:1})}const wt=B(me,[["render",Bt],["__scopeId","data-v-57c0fa59"]]),Mt=y({name:"BeatmapPageFilters",components:{FilterBox:ue,ModeFilters:pe},data(){return{statuses:{any:"Any",WIP:"WIP",Done:"Done",Qualified:"Qualified",Ranked:"Ranked"},quests:{any:"Any",none:"None"}}},computed:O("beatmaps",["filterMode","filterValue","filterStatus","filterQuest"]),methods:{...de("beatmaps",["updateFilterValue","updateFilterMode","updateFilterStatus","updateFilterQuest"]),getStatusSortClass(e){return this.filterStatus===e?"sorted":"unsorted"},getQuestSortClass(e){return this.filterQuest===e?"sorted":"unsorted"}}}),It={class:"container card card-body py-3 mb-2"},Lt=s("button",{class:"btn btn-primary",href:"#","data-bs-toggle":"modal","data-bs-target":"#addBeatmap"},[b(" Add beatmap "),s("i",{class:"fas fa-plus fa-xs"})],-1),Tt={class:"row mt-3"},St=s("div",{class:"col-auto filter-title"}," Status ",-1),Ct={class:"col"},Pt=["onClick"],qt={class:"row mt-3"},Ot=s("div",{class:"col-auto filter-title"}," Quest ",-1),At={class:"col"},Ut=["onClick"];function Ft(e,t,o,l,r,h){const u=f("mode-filters"),n=f("filter-box");return a(),i("div",It,[k(n,{placeholder:"enter to search for song/username...","filter-value":e.filterValue,"onUpdate:filterValue":t[1]||(t[1]=p=>e.updateFilterValue(p))},{filters:q(()=>[k(u,{"filter-mode":e.filterMode,"onUpdate:filterMode":t[0]||(t[0]=p=>e.updateFilterMode(p))},null,8,["filter-mode"]),s("div",Tt,[St,s("div",Ct,[(a(!0),i(M,null,w(e.statuses,(p,g)=>(a(),i("a",{key:g,href:"#",class:v(["status",e.getStatusSortClass(g)]),onClick:L(d=>e.updateFilterStatus(g),["prevent"])},m(p),11,Pt))),128))])]),s("div",qt,[Ot,s("div",At,[(a(!0),i(M,null,w(e.quests,(p,g)=>(a(),i("a",{key:g,href:"#",class:v(["quest",e.getQuestSortClass(g)]),onClick:L(d=>e.updateFilterQuest(g),["prevent"])},m(p),11,Ut))),128))])])]),default:q(()=>[Lt]),_:1},8,["filter-value"])])}const Qt=B(Mt,[["render",Ft]]);function Q(e,t,o){const l={class:["px-1","text-"+t.toLowerCase()]};return o&&(l["data-bs-toggle"]="tooltip",l["data-bs-placement"]="top",l.title=o),N("span",l,e)}const x=y({props:{tasks:{type:Array,required:!0},tasksLocked:{type:Array,required:!0},mode:{type:String,required:!0}},render(){const e=[{name:"Easy",short:"E",locked:!1,status:[]},{name:"Normal",short:"N",locked:!1,status:[]},{name:"Hard",short:"H",locked:!1,status:[]},{name:"Insane",short:"I",locked:!1,status:[]},{name:"Expert",short:"X",locked:!1,status:[]}],t=[{name:"osu",short:"circle",count:0,status:A.Done},{name:"taiko",short:"drum",count:0,status:A.Done},{name:"catch",short:"apple-alt",count:0,status:A.Done},{name:"mania",short:"stream",count:0,status:A.Done}],o=[],l=this.tasks.length>=10,r=this.mode===U.Hybrid;for(const h of e){let u=!1;const n=this.tasksLocked.includes(h.name);for(const p of this.tasks)if(h.name===p.name){h.status.push(p.status),u=!0;const g=t.findIndex(d=>d.name===p.mode);g!==-1&&(t[g].count++,p.status===A.WIP&&(t[g].status=A.WIP))}if(!r){if(l&&h.status.length>1)o.push(Q(h.short+"+","secondary",h.status.length.toString()));else for(const p of h.status)o.push(Q(h.short,p));u||o.push(Q(h.short,n?"blocked":"open"))}}if(r)for(const h of t)o.push(Q([N("i",{class:["fas","fa-"+h.short]})],h.count?h.status:"blocked",h.count.toString()));return N("span",{class:"fw-bold"},o)}}),Vt=y({props:{beatmap:{type:Object,required:!0},bigIcon:{type:Boolean,default:!1}},computed:{url(){var e;if(this.beatmap.mission)switch(this.beatmap.mission.tier){case 1:return"/images/dark-bronze.png";case 2:return"/images/dark-silver.png";case 3:return"/images/dark-gold.png";case 4:return"/images/dark-platinum.png";default:return"/images/dark-bronze.png"}return this.beatmap.isShowcase||!((e=this.beatmap.quest)!=null&&e.art)?"/images/no-art-icon.png":this.beatmap.quest.isMbc?"/images/mbc-icon.png":`https://assets.ppy.sh/artists/${this.beatmap.quest.art}/cover.jpg`}}});const Et=["src"];function Dt(e,t,o,l,r,h){var n;const u=T("bs-tooltip");return e.beatmap.quest||e.beatmap.mission||e.beatmap.isShowcase?$((a(),i("img",{key:(n=e.$route.query.id)==null?void 0:n.toString(),class:v(["rounded-circle me-1",e.bigIcon?"quest-icon-big":"quest-icon"]),src:e.url},null,10,Et)),[[u,e.beatmap.quest&&e.beatmap.quest.name||e.beatmap.mission&&e.beatmap.mission.name||"FA showcase"]]):c("",!0)}const j=B(Vt,[["render",Dt],["__scopeId","data-v-bf21f912"]]),Nt=y({name:"BeatmapCard",components:{ProcessTasks:x,QuestImg:j,ModesIcons:V},props:{beatmap:{type:Object,required:!0}},emits:["update:selectedBeatmap"],data(){return{defaultUrl:"https://osu.ppy.sh/images/layout/beatmaps/default-bg.png"}},computed:{statusBorder(){return this.beatmap.status?"card-status-"+this.beatmap.status.toLowerCase():""}},methods:{fallbackImage(e){e.target.src=this.defaultUrl},formatMetadata(e,t){return e+" - "+t},processUrl(e){if(e&&e.indexOf("osu.ppy.sh/beatmapsets/")!==-1){const t=e.indexOf("beatmapsets/")+12,o=e.indexOf("#");let l;return o!==-1?l=e.slice(t,o):l=e.slice(t),`https://assets.ppy.sh/beatmaps/${l}/covers/card.jpg`}else return this.defaultUrl}}});const Ht=["src"],Gt={class:"card-img-overlay",style:{padding:"0.50rem 0.50rem 0 0.50rem"}},jt={class:"card-title mb-1 text-truncate"},Rt={class:"card-text"};function Wt(e,t,o,l,r,h){const u=f("quest-img"),n=f("user-link"),p=f("modes-icons"),g=f("process-tasks");return a(),i("div",{class:"my-2 col-sm-12 col-md-6 col-lg-4",onClick:t[1]||(t[1]=d=>e.$emit("update:selectedBeatmap",e.beatmap))},[s("div",{class:v(["card card-hover map-card bg-dark",e.statusBorder]),"data-bs-toggle":"modal","data-bs-target":"#editBeatmap"},[s("img",{class:"card-img",src:e.processUrl(e.beatmap.url),style:{opacity:"0.2"},onError:t[0]||(t[0]=d=>e.fallbackImage(d))},null,40,Ht),s("div",Gt,[s("p",jt,m(e.formatMetadata(e.beatmap.song.artist,e.beatmap.song.title)),1),s("small",Rt,[k(u,{beatmap:e.beatmap},null,8,["beatmap"]),b(" Hosted by "),k(n,{class:"me-1",user:e.beatmap.host},null,8,["user"]),e.beatmap.mode!=="osu"?(a(),I(p,{key:0,modes:[e.beatmap.mode]},null,8,["modes"])):c("",!0),k(g,{class:"float-end pt-1",tasks:e.beatmap.tasks,"tasks-locked":e.beatmap.tasksLocked,mode:e.beatmap.mode},null,8,["tasks","tasks-locked","mode"])])])],2)])}const ee=B(Nt,[["render",Wt],["__scopeId","data-v-87c36204"]]),zt=y({components:{BeatmapCard:ee},computed:X("beatmaps",["hostedBeatmaps"]),methods:J("beatmaps",["setSelectedBeatmap"])}),Kt={class:"container card card-body py-3"},Yt={class:"ms-2"},Xt={href:"#hostedBeatmaps","data-bs-toggle":"collapse"},Jt=s("i",{class:"fas fa-angle-down"},null,-1),Zt={key:0,id:"hostedBeatmaps",class:"show"},xt={key:0,class:"ms-5 text-secondary"};function es(e,t,o,l,r,h){const u=f("beatmap-card");return a(),i("div",Kt,[s("h5",Yt,[s("a",Xt,[b(" My mapsets ("+m(e.hostedBeatmaps?e.hostedBeatmaps.length:"...")+") ",1),Jt])]),e.hostedBeatmaps?(a(),i("div",Zt,[k(G,{name:"list",tag:"div",class:"row"},{default:q(()=>[(a(!0),i(M,null,w(e.hostedBeatmaps,n=>(a(),I(u,{key:n.id,beatmap:n,"onUpdate:selectedBeatmap":t[0]||(t[0]=p=>e.setSelectedBeatmap(p))},null,8,["beatmap"]))),128))]),_:1}),e.hostedBeatmaps.length?c("",!0):(a(),i("p",xt," None... "))])):c("",!0)])}const ts=B(zt,[["render",es]]),ss=y({components:{BeatmapCard:ee},props:{isLoadingGuestBeatmaps:Boolean},computed:X("beatmaps",["guestDifficultyBeatmaps"]),methods:J("beatmaps",["setSelectedBeatmap"])}),as={class:"container card card-body py-3"},os={class:"ms-2"},is={href:"#guestDifficultyBeatmaps","data-bs-toggle":"collapse"},ns=s("i",{class:"fas fa-angle-down"},null,-1),ls={key:0,class:"ms-5 text-secondary"};function ds(e,t,o,l,r,h){const u=f("beatmap-card");return a(),i("div",as,[s("h5",os,[s("a",is,[b(" My guest difficulties ("+m(e.guestDifficultyBeatmaps&&!e.isLoadingGuestBeatmaps?e.guestDifficultyBeatmaps.length:"...")+") ",1),ns])]),e.guestDifficultyBeatmaps?(a(),i("div",{key:0,id:"guestDifficultyBeatmaps",class:v(["collapse",{"loading-data":e.isLoadingGuestBeatmaps}])},[!e.guestDifficultyBeatmaps.length&&!e.isLoadingGuestBeatmaps?(a(),i("p",ls," None... ")):c("",!0),k(G,{name:"list",tag:"div",class:"row"},{default:q(()=>[(a(!0),i(M,null,w(e.guestDifficultyBeatmaps,n=>(a(),I(u,{key:n.id,beatmap:n,"onUpdate:selectedBeatmap":t[0]||(t[0]=p=>e.setSelectedBeatmap(p))},null,8,["beatmap"]))),128))]),_:1})],2)):c("",!0)])}const rs=B(ss,[["render",ds]]),us=y({name:"ModeChoice",props:{beatmap:{type:Object,required:!0}},data(){return{selectedMode:this.beatmap.mode,showInput:!1,modes:[{value:"osu",name:"osu!"},{value:"taiko",name:"osu!taiko"},{value:"catch",name:"osu!catch"},{value:"mania",name:"osu!mania"},{value:"hybrid",name:"Multiple modes"}]}},methods:{async setMode(e){const t=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/setMode`,{mode:this.selectedMode},e);this.$http.isError(t)||this.$store.dispatch("beatmaps/updateBeatmap",t),this.showInput=!1}}}),ps={id:"mode"},cs={class:"row mb-2"},ms={class:"col"},hs=s("i",{class:"fas fa-edit"},null,-1),fs=[hs],bs={class:"small ms-3 text-secondary"},_s={key:0,class:"row mb-2"},ks={class:"col"},$s={class:"input-group input-group-sm"},gs=["value"];function ys(e,t,o,l,r,h){const u=T("bs-tooltip");return a(),i("div",ps,[s("div",cs,[s("div",ms,[s("div",null,[b(" Mode "),$((a(),i("a",{id:"editMode",href:"#",class:v([e.showInput?"text-danger":"","text-success small ms-1"]),onClick:t[0]||(t[0]=L(n=>e.showInput=!e.showInput,["prevent"]))},fs,2)),[[u,"edit mode","right"]])]),s("div",bs,m(e.beatmap.mode=="hybrid"?"Multiple modes":e.beatmap.mode=="osu"?"osu!":"osu!"+e.beatmap.mode),1)])]),e.showInput?(a(),i("div",_s,[s("div",ks,[s("div",$s,[$(s("select",{"onUpdate:modelValue":t[1]||(t[1]=n=>e.selectedMode=n),class:"form-select"},[(a(!0),i(M,null,w(e.modes,n=>(a(),i("option",{key:n.value,value:n.value},m(n.name),9,gs))),128))],512),[[P,e.selectedMode]]),$((a(),i("button",{class:"btn btn-outline-info",onClick:t[2]||(t[2]=n=>e.setMode(n))},[b(" Save ")])),[[u,"link beatmap to quest"]])])])])):c("",!0)])}const vs=B(us,[["render",ys]]),Bs=y({name:"StatusChoice",props:{beatmap:{type:Object,required:!0}},methods:{async setStatus(e,t){const o=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/setStatus`,{status:e},t);this.$http.isError(o)||this.$store.dispatch("beatmaps/updateBeatmap",o)}}}),ws={id:"mapsetStatus"},Ms=s("div",{class:"d-inline-block me-2"}," Status ",-1),Is=["disabled"],Ls=["disabled"],Ts={class:"small text-secondary"},Ss=s("div",{class:"small text-secondary mt-1"},[s("div",{class:"small"},' Maps marked as "Done" will be processed for points when they reach the Ranked category on osu!. ')],-1);function Cs(e,t,o,l,r,h){const u=T("bs-tooltip");return a(),i("div",ws,[Ms,$((a(),i("button",{class:v(["btn btn-sm me-1",e.beatmap.status=="WIP"?"btn-warning":"btn-outline-warning"]),disabled:e.beatmap.status=="WIP",onClick:t[0]||(t[0]=n=>e.setStatus("WIP",n))},[b(" WIP ")],10,Is)),[[u,"mark mapset as work-in-progress","bottom"]]),$((a(),i("button",{class:v(["btn btn-sm me-1",e.beatmap.status=="Done"?"btn-success":"btn-outline-success"]),disabled:e.beatmap.status=="Done",onClick:t[1]||(t[1]=n=>e.setStatus("Done",n))},[b(" Done ")],10,Ls)),[[u,"mark mapset and all diffs as done","bottom"]]),s("span",Ts,'(currently "'+m(e.beatmap.status)+'")',1),Ss])}const Ps=B(Bs,[["render",Cs]]),qs=y({name:"QuestOrMissionChoice",props:{beatmap:{type:Object,required:!0}},data(){return{userQuests:[],openMissions:[],showInput:!1,dropdownId:""}},computed:O(["loggedInUser"]),watch:{async beatmap(){var t,o;this.showInput=!1,this.dropdownId=((t=this.beatmap.quest)==null?void 0:t.id)||((o=this.beatmap.mission)==null?void 0:o.id)||"";const e=await this.$http.executeGet(`/missions/open/${this.beatmap.mode}/${this.beatmap.id}`);this.$http.isError(e)||(this.openMissions=e)}},async created(){const e=await this.$http.executeGet(`/users/${this.loggedInUser.id}/quests`),t=await this.$http.executeGet(`/missions/open/${this.beatmap.mode}/${this.beatmap.id}`);this.$http.isError(e)||(this.userQuests=e),this.$http.isError(t)||(this.openMissions=t)},methods:{async linkQuestOrMission(e){const t=this.userQuests.find(l=>l.id==this.dropdownId),o=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/${t?"linkQuest":"linkMission"}`,{questOrMissionId:this.dropdownId},e);this.$http.isError(o)||this.$store.dispatch("beatmaps/updateBeatmap",o)}}}),Os={class:"row mb-2"},As={class:"col"},Us=s("i",{class:"fas fa-edit"},null,-1),Fs=[Us],Qs={class:"small ms-3 text-secondary"},Vs=["href"],Es=["href"],Ds={key:2},Ns={key:0,class:"row mb-2"},Hs={class:"col"},Gs={class:"input-group input-group-sm"},js=s("option",{value:""}," No quest ",-1),Rs={key:0,disabled:""},Ws=["value"],zs={key:1,disabled:""},Ks=["value"];function Ys(e,t,o,l,r,h){const u=T("bs-tooltip");return a(),i("div",null,[s("div",Os,[s("div",As,[s("div",null,[b(" Quest "),$((a(),i("a",{id:"editLink",href:"#",class:v([e.showInput?"text-danger":"","text-success small ms-1"]),onClick:t[0]||(t[0]=L(n=>e.showInput=!e.showInput,["prevent"]))},Fs,2)),[[u,"connect mapset with a quest","right"]])]),s("div",Qs,[e.beatmap.quest?(a(),i("a",{key:0,href:`/quests?id=${e.beatmap.quest.id}`},m(e.beatmap.quest.name),9,Vs)):e.beatmap.mission?(a(),i("a",{key:1,href:`/missions?id=${e.beatmap.mission.id}`},m(e.beatmap.mission.name),9,Es)):(a(),i("i",Ds,"none"))])])]),e.showInput?(a(),i("div",Ns,[s("div",Hs,[s("div",Gs,[$(s("select",{"onUpdate:modelValue":t[1]||(t[1]=n=>e.dropdownId=n),class:"form-select"},[js,e.userQuests.length?(a(),i("option",Rs," --- claimed quests --- ")):c("",!0),(a(!0),i(M,null,w(e.userQuests,n=>(a(),i("option",{key:n.id,value:n.id},m(n.name),9,Ws))),128)),e.openMissions.length?(a(),i("option",zs," --- open priority quests --- ")):c("",!0),(a(!0),i(M,null,w(e.openMissions,n=>(a(),i("option",{key:n.id,value:n.id},m(n.name),9,Ks))),128))],512),[[P,e.dropdownId]]),$((a(),i("button",{class:"btn btn-outline-info",onClick:t[2]||(t[2]=n=>e.linkQuestOrMission(n))},[b(" Save ")])),[[u,"link beatmap to quest"]])])])])):c("",!0)])}const Xs=B(qs,[["render",Ys]]),Js=y({name:"ModdersList",components:{UserLinkList:H},props:{canEdit:Boolean,beatmap:{type:Object,required:!0}},computed:{...O(["loggedInUser"]),isModder(){return this.beatmap.modders.some(e=>e.osuId==this.loggedInUser.osuId)}},methods:{async updateModder(e){e.target.classList.add("fake-button-disable");const t=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/updateModder`);this.$http.isError(t)||this.$store.dispatch("beatmaps/updateBeatmap",t),e.target.classList.remove("fake-button-disable")}}}),Zs={id:"modders",class:"row mb-2"},xs={class:"col"},ea={key:0,class:"ms-1"},ta={class:"small ms-3"},sa={key:0,class:"text-secondary"};function aa(e,t,o,l,r,h){const u=f("user-link-list"),n=T("bs-tooltip");return a(),i("div",Zs,[s("div",xs,[s("div",null,[b(" Modders ("+m(e.beatmap.modders.length)+") ",1),e.canEdit?$((a(),i("small",ea,[s("a",{href:"#",class:v(e.isModder?"text-danger":"text-success"),onClick:t[0]||(t[0]=L(p=>e.updateModder(p),["prevent"]))},[s("i",{class:v(["fas",e.isModder?"fa-minus":"fa-plus"])},null,2)],2)])),[[n,"add/remove yourself from modder list","right"]]):c("",!0)]),s("div",ta,[e.beatmap.modders.length==0?(a(),i("i",sa," none ")):(a(),I(u,{key:1,users:e.beatmap.modders},null,8,["users"]))])])])}const oa=B(Js,[["render",aa]]),ia=y({name:"NominatorsList",components:{UserLinkList:H},props:{canEdit:Boolean,beatmap:{type:Object,required:!0}},computed:{...O(["loggedInUser"]),isBn(){return this.beatmap.bns.some(e=>e.osuId==this.loggedInUser.osuId)}},methods:{async updateBn(e){e.target.classList.add("fake-button-disable");const t=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/updateBn`);this.$http.isError(t)||this.$store.dispatch("beatmaps/updateBeatmap",t),e.target.classList.remove("fake-button-disable")}}}),na={key:0,class:"ms-1"},la=s("i",{class:"fas fa-minus"},null,-1),da=[la],ra=s("i",{class:"fas fa-plus"},null,-1),ua=[ra],pa={class:"small ms-3"},ca={key:0,class:"text-secondary"};function ma(e,t,o,l,r,h){const u=f("user-link-list"),n=T("bs-tooltip");return a(),i("div",null,[s("div",null,[b(" Nominators ("+m(e.beatmap.bns.length)+") ",1),e.canEdit?$((a(),i("small",na,[e.isBn?(a(),i("a",{key:0,href:"#",class:"text-danger",onClick:t[0]||(t[0]=L(p=>e.updateBn(p),["prevent"]))},da)):c("",!0),!e.isBn&&e.beatmap.bns.length<2?(a(),i("a",{key:1,href:"#",class:"text-success",onClick:t[1]||(t[1]=L(p=>e.updateBn(p),["prevent"]))},ua)):c("",!0)])),[[n,"add/remove yourself from potential BN list","right"]]):c("",!0)]),s("div",pa,[e.beatmap.bns.length==0?(a(),i("i",ca,"none")):(a(),I(u,{key:1,users:e.beatmap.bns},null,8,["users"]))])])}const ha=B(ia,[["render",ma]]),fa=y({name:"BeatmapLink",props:{beatmap:{type:Object,required:!0}},data(){return{url:"",showLinkInput:!1}},watch:{beatmap(e){e&&(this.showLinkInput=!1,this.url=e.url)}},created(){this.url=this.beatmap.url},methods:{async saveLink(e){const t=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/setLink`,{url:this.url},e);this.$http.isError(t)||(this.showLinkInput=!1,this.$store.dispatch("beatmaps/updateBeatmap",t))}}}),ba={class:"row mb-2"},_a={class:"col"},ka=s("i",{class:"fas fa-edit"},null,-1),$a=[ka],ga={class:"small ms-3"},ya=["href"],va={key:1,class:"text-secondary"},Ba={key:0,class:"row mb-2"},wa={class:"col-sm-12"},Ma={class:"input-group input-group-sm"};function Ia(e,t,o,l,r,h){const u=T("bs-tooltip");return a(),i("div",null,[s("div",ba,[s("div",_a,[s("div",null,[b(" Link "),$((a(),i("a",{id:"editLink",href:"#",class:v(["text-success small ms-1",{"text-danger":e.showLinkInput}]),onClick:t[0]||(t[0]=L(n=>e.showLinkInput=!e.showLinkInput,["prevent"]))},$a,2)),[[u,"edit link","right"]])]),s("div",ga,[e.beatmap.url?(a(),i("a",{key:0,href:e.beatmap.url,target:"_blank",class:"text-truncate",style:{display:"block"}},m(e.beatmap.url),9,ya)):(a(),i("i",va,"none"))])])]),e.showLinkInput?(a(),i("div",Ba,[s("div",wa,[s("div",Ma,[$(s("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>e.url=n),class:"form-control form-control-sm",type:"text",placeholder:"URL",onKeyup:t[2]||(t[2]=D(n=>e.saveLink(n),["enter"]))},null,544),[[E,e.url]]),s("button",{id:"addLinkButton",class:"btn btn-outline-info",type:"submit",onClick:t[3]||(t[3]=n=>e.saveLink(n))}," Save ")])])])):c("",!0)])}const La=B(fa,[["render",Ia]]),Ta=y({name:"LocksChoice",props:{beatmap:{type:Object,required:!0},beatmapId:{type:String,required:!0}},data(){return{lockTaskSelection:"",showLocksInput:!1,phaseEdit:!1}},computed:{remainingTasks(){var t,o;let e=F;return(o=(t=this.beatmap)==null?void 0:t.tasksLocked)!=null&&o.length&&(e=e.filter(l=>!this.beatmap.tasksLocked.includes(l))),this.beatmap.mode==U.Taiko&&(e=e.filter(l=>l!==C.Hitsounds)),e}},watch:{beatmapId(){this.showLocksInput=!1},beatmap(){this.beatmap.tasksLocked.length>=6&&(this.showLocksInput=!1)}},methods:{async unlockTask(e,t){t.target.classList.add("fake-button-disable");const o=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/unlockTask`,{task:e});this.$http.isError(o)||this.$store.dispatch("beatmaps/updateBeatmap",o),t.target.classList.remove("fake-button-disable")},async lockTask(e){const t=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/lockTask`,{task:this.lockTaskSelection},e);this.$http.isError(t)||this.$store.dispatch("beatmaps/updateBeatmap",t)}}}),Sa={id:"locks",class:"row mb-1"},Ca={class:"col"},Pa=s("i",{class:"fas fa-edit"},null,-1),qa=[Pa],Oa={class:"small ms-3"},Aa={key:0},Ua={key:1},Fa=["onClick"],Qa=s("i",{class:"fas fa-minus"},null,-1),Va=[Qa],Ea={class:"text-secondary mx-1"},Da={key:0,class:"row"},Na={class:"col"},Ha={class:"input-group input-group-sm"},Ga=["value"],ja=s("i",{class:"fas fa-lock"},null,-1),Ra=[ja];function Wa(e,t,o,l,r,h){const u=T("bs-tooltip");return a(),i("div",null,[s("div",Sa,[s("div",Ca,[s("div",null,[b(" Locks "),(e.beatmap.mode=="taiko"?e.beatmap.tasksLocked.length<6:e.beatmap.tasksLocked.length<7)?$((a(),i("a",{key:0,class:v(["text-success small ms-1",{"text-danger":e.showLocksInput}]),href:"#",onClick:t[0]||(t[0]=L(n=>e.showLocksInput=!e.showLocksInput,["prevent"]))},qa,2)),[[u,"edit locks","right"]]):c("",!0)]),s("div",Oa,[e.beatmap.tasksLocked.length==0?(a(),i("i",Aa,"none")):c("",!0),e.beatmap.tasksLocked.length>0?(a(),i("div",Ua,[(a(!0),i(M,null,w(e.beatmap.tasksLocked,n=>(a(),i("div",{key:n},[$((a(),i("a",{href:"#",class:v(["text-danger",e.phaseEdit?"fake-button-disable":""]),onClick:L(p=>e.unlockTask(n,p),["prevent"])},Va,10,Fa)),[[u,"unlock","left"]]),s("span",Ea,m(n),1)]))),128))])):c("",!0)])])]),e.showLocksInput?(a(),i("div",Da,[s("div",Na,[s("div",Ha,[$(s("select",{"onUpdate:modelValue":t[1]||(t[1]=n=>e.lockTaskSelection=n),class:"form-select"},[(a(!0),i(M,null,w(e.remainingTasks,n=>(a(),i("option",{key:n,value:n},m(n),9,Ga))),128))],512),[[P,e.lockTaskSelection]]),$((a(),i("button",{id:"lockTask",class:"btn btn-outline-info",onClick:t[2]||(t[2]=n=>e.lockTask(n))},Ra)),[[u,"prevent other mappers from claiming a difficulty","right"]])])])])):c("",!0)])}const za=B(Ta,[["render",Wa]]),Ka=y({name:"Points",props:{beatmap:{type:Object,required:!0}},data(){return{tasksPointsArray:null,usersPointsArrays:null,pointsInfo:null,totalPoints:null,bnPoints:null,isLoading:!1}},watch:{beatmap(){this.tasksPointsArray=null,this.usersPointsArrays=null,this.pointsInfo=null,this.totalPoints=null,this.bnPoints=null,this.isLoading=!1}},methods:{async findPoints(e){this.isLoading=!0;const t=await this.$http.executeGet(`/beatmaps/${this.beatmap.id}/findPoints`,e);this.$http.isError(t)||(this.tasksPointsArray=t.tasksPointsArray,this.usersPointsArrays=t.usersPointsArrays,this.pointsInfo=t.pointsInfo,this.totalPoints=t.totalPoints,this.bnPoints=t.bnPoints),this.isLoading=!1}}}),Ya={class:"row"},Xa={class:"col-sm-12"},Ja={key:1,class:"small text-danger"},Za={key:0},xa={key:2,class:"small text-secondary ms-2"},eo={key:3,class:"small text-secondary ms-2"},to={key:0,class:"col-sm-6"},so={class:"small text-secondary"},ao=s("li",null,"Map host: 3",-1),oo={class:"col-sm-6"},io={key:0,class:"small text-secondary"},no={key:1,class:"col-sm-12"},lo={class:"small text-secondary ms-2"};function ro(e,t,o,l,r,h){const u=T("bs-tooltip");return a(),i("div",null,[s("div",Ya,[s("div",Xa,[!e.tasksPointsArray&&!e.beatmap.invalidForPoints?$((a(),i("button",{key:0,class:"btn btn-sm btn-outline-info ms-1",onClick:t[0]||(t[0]=n=>e.findPoints(n))},[b(" Calculate points ")])),[[u,"calculate points for all difficulties"]]):c("",!0),e.beatmap.invalidForPoints?(a(),i("div",Ja,[b(" This beatmap is ineligible for points "),e.beatmap.invalidReason?(a(),i("span",Za,[b(" for the following reason: "),s("i",null,m(e.beatmap.invalidReason),1)])):c("",!0)])):c("",!0),e.isLoading?(a(),i("div",xa," calculating... ")):e.pointsInfo?(a(),i("div",eo,m(e.pointsInfo),1)):c("",!0)]),e.tasksPointsArray?(a(),i("div",to,[s("ul",so,[(a(!0),i(M,null,w(e.tasksPointsArray,(n,p)=>(a(),i("li",{key:p},m(n),1))),128)),s("li",null,"BN mod/nomination: "+m(e.bnPoints),1),ao])])):c("",!0),s("div",oo,[e.usersPointsArrays?(a(),i("ul",io,[(a(!0),i(M,null,w(e.usersPointsArrays,(n,p)=>(a(),i("li",{key:p},m(e.usersPointsArrays[p][0])+": "+m(e.usersPointsArrays[p][0]==e.beatmap.host.username?e.usersPointsArrays[p][1]+3:e.usersPointsArrays[p][1]),1))),128))])):c("",!0)]),e.totalPoints?(a(),i("div",no,[s("span",lo," total: "+m(Math.round(e.totalPoints*10)/10+3),1)])):c("",!0)])])}const uo=B(Ka,[["render",ro]]),po=y({name:"BeatmapInfo",components:{ModeChoice:vs,StatusChoice:Ps,TasksChoice:ce,QuestOrMissionChoice:Xs,ModdersList:oa,NominatorsList:ha,BeatmapLink:La,LocksChoice:za,Points:uo},props:{beatmap:{type:Object,required:!0}},data(){return{userQuests:null}},computed:{...O(["loggedInUser"]),isHost(){return this.loggedInUser.id&&this.beatmap?this.loggedInUser.id===this.beatmap.host.id:!1},isRanked(){return this.beatmap.status===W.Ranked},isQualified(){return this.beatmap.status===W.Qualified}},methods:{async deleteMap(e){if(confirm("Are you sure you want to delete?")){e.target.disabled=!0;const o=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/delete`,{},e);this.$http.isError(o)||(this.$bs.hideModal("editBeatmap"),this.$store.commit("beatmaps/deleteBeatmap",o)),e.target.disabled=!1}}}});const R=e=>(K("data-v-2a6fa355"),e=e(),Y(),e),co={key:0,class:"container"},mo={class:"row"},ho={key:0,class:"row mb-2"},fo={class:"col-sm-6"},bo={key:0,id:"bns",class:"col-sm-6"},_o={key:1},ko=R(()=>s("hr",null,null,-1)),$o={class:"row"},go={class:"col-sm"},yo={key:0,class:"col-lg-5 bm-col-separator-left"},vo={key:0,class:"row"},Bo={class:"col-sm"},wo=R(()=>s("hr",null,null,-1)),Mo={class:"row"},Io={class:"col-sm"},Lo=R(()=>s("hr",null,null,-1)),To={class:"row"},So={class:"col-sm-4 text-end"},Co={class:"small text-secondary"};function Po(e,t,o,l,r,h){const u=f("modders-list"),n=f("nominators-list"),p=f("tasks-choice"),g=f("status-choice"),d=f("mode-choice"),S=f("quest-or-mission-choice"),se=f("beatmap-link"),ae=f("locks-choice"),oe=f("points");return e.beatmap?(a(),i("div",co,[s("div",mo,[s("div",{class:v(e.isHost&&!e.isRanked?"col-lg-7":"col-sm-12")},[e.$route.path.includes("world")?(a(),i("div",_o,[s("code",null,"https://mappersguild.com/beatmaps?id="+m(e.beatmap.id),1)])):(a(),i("div",ho,[s("div",fo,[k(u,{beatmap:e.beatmap,"can-edit":!e.isHost&&!e.isRanked},null,8,["beatmap","can-edit"])]),!e.isRanked||e.beatmap.bns?(a(),i("div",bo,[k(n,{beatmap:e.beatmap,"can-edit":!e.isHost&&!e.isRanked},null,8,["beatmap","can-edit"])])):c("",!0)])),ko,s("div",$o,[s("div",go,[k(p,{beatmap:e.beatmap,"is-host":e.isHost,"is-ranked":e.isRanked,"is-qualified":e.isQualified},null,8,["beatmap","is-host","is-ranked","is-qualified"])])])],2),e.isHost&&!e.isRanked?(a(),i("div",yo,[e.isQualified?c("",!0):(a(),i("div",vo,[s("div",Bo,[k(g,{beatmap:e.beatmap},null,8,["beatmap"]),wo])])),s("div",Mo,[s("div",Io,[e.beatmap.status=="WIP"?(a(),I(d,{key:0,class:"mb-2",beatmap:e.beatmap},null,8,["beatmap"])):c("",!0)])]),k(S,{beatmap:e.beatmap},null,8,["beatmap"]),e.isQualified?c("",!0):(a(),I(se,{key:1,beatmap:e.beatmap},null,8,["beatmap"])),e.beatmap.status=="WIP"?(a(),I(ae,{key:2,beatmap:e.beatmap,"beatmap-id":e.beatmap.id},null,8,["beatmap","beatmap-id"])):c("",!0)])):c("",!0)]),Lo,s("div",To,[k(oe,{class:"col-sm-8",beatmap:e.beatmap},null,8,["beatmap"]),s("div",So,[s("span",Co," Created: "+m(e.beatmap.createdAt.toString().slice(0,10)),1),e.isHost&&!e.isRanked?(a(),i("button",{key:0,id:"deleteButton",class:"btn btn-sm btn-outline-danger ms-2",onClick:t[0]||(t[0]=ie=>e.deleteMap(ie))}," Delete ")):c("",!0)])])])):c("",!0)}const te=B(po,[["render",Po],["__scopeId","data-v-2a6fa355"]]),qo=y({name:"BeatmapTableRow",components:{BeatmapInfo:te,ProcessTasks:x,QuestImg:j,ModesIcons:V},props:{beatmap:{type:Object,required:!0}},methods:{selectBeatmap(){this.$route.query.id!==this.beatmap.id&&this.$router.push(`/beatmaps?id=${this.beatmap.id}`)},formatMetadata(){return this.beatmap.song.artist+" - "+this.beatmap.song.title},statusBorder(){return this.beatmap.status?"card-status-"+this.beatmap.status.toLowerCase():""}}}),Oo={class:"container"},Ao={class:"row"},Uo={class:"col-sm-6"},Fo=["data-bs-target"],Qo=s("i",{class:"fas fa-angle-down"},null,-1),Vo={class:"col-sm-2 small d-flex justify-content-end align-items-center"},Eo={class:"col-sm-3 small"},Do=s("span",{class:"text-secondary me-1"},"Hosted by",-1),No={key:0,class:"text-secondary"},Ho={key:0,class:"col-sm-1 d-flex justify-content-end align-items-center"},Go=["href"],jo=s("i",{class:"fas fa-link"},null,-1),Ro=[jo],Wo=["id"];function zo(e,t,o,l,r,h){const u=f("quest-img"),n=f("process-tasks"),p=f("user-link"),g=f("modes-icons"),d=f("beatmap-info");return a(),i("div",null,[s("div",{class:v(["card card-body card-level-2 my-1 p-1",e.statusBorder()])},[s("div",Oo,[s("div",Ao,[s("div",Uo,[k(u,{beatmap:e.beatmap},null,8,["beatmap"]),s("a",{href:"#","data-bs-toggle":"collapse","data-bs-target":"#details"+e.beatmap.id,class:"text-truncate",onClick:t[0]||(t[0]=S=>e.selectBeatmap())},[b(m(e.formatMetadata())+" ",1),Qo],8,Fo)]),s("div",Vo,[k(n,{tasks:e.beatmap.tasks,"tasks-locked":e.beatmap.tasksLocked,mode:e.beatmap.mode},null,8,["tasks","tasks-locked","mode"])]),s("div",Eo,[Do,k(p,{class:"me-1",user:e.beatmap.host},null,8,["user"]),e.beatmap.mode!=="osu"?(a(),i("span",No,[k(g,{modes:[e.beatmap.mode],color:"secondary"},null,8,["modes"])])):c("",!0)]),e.beatmap.url?(a(),i("div",Ho,[s("a",{href:e.beatmap.url,target:"_blank"},Ro,8,Go)])):c("",!0)])])],2),s("div",{id:"details"+e.beatmap.id,class:v(["collapse my-2 mx-4 row border-end border-start py-3","border-"+e.beatmap.status.toLowerCase()])},[k(d,{beatmap:e.beatmap},null,8,["beatmap"])],10,Wo)])}const Ko=B(qo,[["render",zo]]),Yo=y({components:{BeatmapTableRow:Ko},computed:O("beatmaps",{otherBeatmaps:"allBeatmaps",isLoadingOtherBeatmaps:"isLoadingOtherBeatmaps",filterValue:"filterValue"}),methods:{async showMore(e){e.target.disabled=!0,this.$store.commit("beatmaps/increaseFetchLimit"),await this.$store.dispatch("beatmaps/loadOtherBeatmaps"),e.target.disabled=!1}}}),Xo={class:"container card card-body py-3"},Jo={class:"ms-2"},Zo={href:"#otherBeatmaps","data-bs-toggle":"collapse"},xo=s("i",{class:"fas fa-angle-down"},null,-1),ei={key:0,id:"otherBeatmaps",class:"collapse"},ti={key:0,class:"ms-5 text-secondary"},si={key:1,class:"text-center"},ai=s("i",{class:"fas fa-angle-down me-1"},null,-1),oi=s("i",{class:"fas fa-angle-down ms-1"},null,-1);function ii(e,t,o,l,r,h){const u=f("beatmap-table-row");return a(),i("div",Xo,[s("h5",Jo,[s("a",Zo,[b(" Other beatmaps ("+m(e.otherBeatmaps&&!e.isLoadingOtherBeatmaps?e.otherBeatmaps.length:"...")+") ",1),xo])]),e.otherBeatmaps?(a(),i("div",ei,[s("div",{class:v({"loading-data":e.isLoadingOtherBeatmaps})},[!e.otherBeatmaps.length&&!e.isLoadingOtherBeatmaps?(a(),i("p",ti," None... ")):c("",!0),(a(!0),i(M,null,w(e.otherBeatmaps,n=>(a(),I(u,{key:n.id,beatmap:n},null,8,["beatmap"]))),128)),e.filterValue?c("",!0):(a(),i("div",si,[s("button",{class:"btn btn-sm btn-outline-info my-4",onClick:t[0]||(t[0]=L(n=>e.showMore(n),["prevent"]))},[ai,b(" show more "),oi])]))],2)])):c("",!0)])}const ni=B(Yo,[["render",ii]]),li=y({components:{BeatmapInfo:te,ModalDialog:Z,QuestImg:j,ModesIcons:V},props:{selectedBeatmap:{type:Object,default:null}},computed:{beatmapStatusColor(){return this.selectedBeatmap&&this.selectedBeatmap.status?`var(--beatmap-${this.selectedBeatmap.status.toLowerCase()})`:"var(--beatmap-secret)"},beatmapBackgroundUrl(){var t;const e=((t=this.selectedBeatmap)==null?void 0:t.url)||"";if(e&&e.indexOf("osu.ppy.sh/beatmapsets/")!==-1){const o=e.indexOf("beatmapsets/")+12,l=e.indexOf("#");let r;return l!==-1?r=e.slice(o,l):r=e.slice(o),`url(https://assets.ppy.sh/beatmaps/${r}/covers/cover.jpg)`}else return"url(https://osu.ppy.sh/images/layout/beatmaps/default-bg.png)"}},watch:{selectedBeatmap(){this.selectedBeatmap&&this.$route.query.id!==this.selectedBeatmap.id&&this.$route.path.includes("beatmaps")&&this.$router.replace(`/beatmaps?id=${this.selectedBeatmap.id}`)}}}),di={class:"text-white mx-3"},ri=["href"],ui=s("i",{class:"fas fa-link"},null,-1),pi={key:1};function ci(e,t,o,l,r,h){const u=f("quest-img"),n=f("user-link"),p=f("modes-icons"),g=f("beatmap-info"),d=f("modal-dialog");return a(),I(d,{id:"editBeatmap",loaded:!!e.selectedBeatmap,"header-style":{background:`linear-gradient(0deg, ${e.beatmapStatusColor} -250%, rgba(0, 0, 0, 0.65) 130%), ${e.beatmapBackgroundUrl} center no-repeat`,borderBottom:`4px solid ${e.beatmapStatusColor}`,backgroundSize:"cover",objectFit:"fill",height:"85px"}},{header:q(()=>[k(u,{beatmap:e.selectedBeatmap,"big-icon":!0},null,8,["beatmap"]),s("span",di,[e.selectedBeatmap.url?(a(),i("a",{key:0,class:"text-white",href:e.selectedBeatmap.url,target:"_blank"},[ui,b(" "+m(e.selectedBeatmap.song.artist)+" - "+m(e.selectedBeatmap.song.title),1)],8,ri)):(a(),i("span",pi,m(e.selectedBeatmap.song.artist)+" - "+m(e.selectedBeatmap.song.title),1)),b(" |"),k(n,{class:"mx-1 text-white",user:e.selectedBeatmap.host},null,8,["user"]),k(p,{modes:[e.selectedBeatmap.mode],color:"white"},null,8,["modes"])])]),default:q(()=>[k(g,{beatmap:e.selectedBeatmap},null,8,["beatmap"])]),_:1},8,["loaded","header-style"])}const mi=B(li,[["render",ci]]),hi={namespaced:!0,state:{allBeatmaps:[],userBeatmaps:[],filterValue:"",filterMode:z.any,filterStatus:"any",filterQuest:"any",selectedBeatmap:null,selectedBeatmapId:null,fetchLimit:30,isLoadingOtherBeatmaps:!0},mutations:{setAllBeatmaps(e,t){e.allBeatmaps=t},setUserBeatmaps(e,t){e.userBeatmaps=t},setFilterValue(e,t){e.filterValue=t},setFilterMode(e,t){e.filterMode=t},setFilterStatus(e,t){e.filterStatus=t},setFilterQuest(e,t){e.filterQuest=t},setIsLoadingOtherBeatmaps(e,t){e.isLoadingOtherBeatmaps=t},increaseFetchLimit(e){e.fetchLimit+=50},setSelectedBeatmap(e,t){const o=Object.values(C);t.tasks.sort(function(l,r){return o.indexOf(l.name)-o.indexOf(r.name)}),t.tasksLocked.sort(function(l,r){return o.indexOf(l)-o.indexOf(r)}),e.selectedBeatmap=t},addBeatmap(e,t){e.userBeatmaps.unshift(t)},updateBeatmap(e,t){let o=e.allBeatmaps.findIndex(l=>l.id===t.id);o!==-1&&(e.allBeatmaps[o]=t),o=e.userBeatmaps.findIndex(l=>l.id===t.id),o!==-1&&(e.userBeatmaps[o]=t)},deleteBeatmap(e,t){let o=e.allBeatmaps.findIndex(l=>l.id===t.id);o!==-1&&e.allBeatmaps.splice(o,1),o=e.userBeatmaps.findIndex(l=>l.id===t.id),o!==-1&&e.userBeatmaps.splice(o,1)}},getters:{filteredUserBeatmaps:e=>{let t=e.userBeatmaps;if(e.filterMode!==z.any){const o=e.filterMode;t=t.filter(l=>l.mode===o||l.mode===U.Hybrid)}if(e.filterStatus!=="any"&&(t=t.filter(o=>o.status===e.filterStatus)),e.filterQuest!=="any"&&(t=t.filter(o=>!o.quest)),e.filterValue){const o=e.filterValue.toLowerCase().trim().split(" ").filter(l=>l.length);t=t.filter(l=>{let r=l.song.artist+" "+l.song.title+" "+l.host.username+" "+l.url;return l.tasks.forEach(h=>{h.mappers.forEach(u=>{r+=" "+u.username})}),r=r.toLowerCase(),o.some(h=>r.includes(h))})}return t},guestDifficultyBeatmaps:(e,t,o)=>t.filteredUserBeatmaps.filter(l=>{var r;return l.host.id!==((r=o.loggedInUser)==null?void 0:r.id)}),hostedBeatmaps:(e,t,o)=>t.filteredUserBeatmaps.filter(l=>{var r;return l.host.id===((r=o.loggedInUser)==null?void 0:r.id)})},actions:{updateBeatmap({commit:e,state:t},o){var l;e("updateBeatmap",o),((l=t.selectedBeatmap)==null?void 0:l.id)===o.id&&e("setSelectedBeatmap",o)},async updateFilterMode({commit:e,dispatch:t},o){e("setFilterMode",o),await t("loadOtherBeatmaps")},async updateFilterStatus({commit:e,dispatch:t},o){e("setFilterStatus",o),await t("loadOtherBeatmaps")},async updateFilterQuest({commit:e,dispatch:t},o){e("setFilterQuest",o),await t("loadOtherBeatmaps")},async updateFilterValue({commit:e,dispatch:t},o){e("setFilterValue",o),await t("loadOtherBeatmaps")},async loadOtherBeatmaps({commit:e,state:t}){var u;e("setIsLoadingOtherBeatmaps",!0);const o=t.filterStatus!=="any"?`&status=${t.filterStatus}`:"",l=t.filterQuest!=="any"?`&quest=${t.filterQuest}`:"",r=t.filterValue?`&search=${t.filterValue}`:"",h=await re.get(`/api/beatmaps/search?mode=${t.filterMode}&limit=${t.fetchLimit+o+l+r}`);(u=h.data)!=null&&u.allBeatmaps&&e("setAllBeatmaps",h.data.allBeatmaps),e("setIsLoadingOtherBeatmaps",!1)}}},fi=hi,bi=y({name:"BeatmapPage",components:{BeatmapPageFilters:Qt,HostedBeatmaps:ts,GuestDifficulties:rs,OtherBeatmaps:ni,EditBeatmapModal:mi,CreateBeatmapModal:wt},data(){return{isLoadingGuestBeatmaps:!0}},computed:O("beatmaps",["selectedBeatmap"]),beforeCreate(){this.$store.hasModule("beatmaps")||this.$store.registerModule("beatmaps",fi)},async created(){const e=this.$route.query.id;let t,o;e?([t,o]=await Promise.all([this.$http.initialRequest("/beatmaps/relevantInfo"),this.$http.executeGet("/beatmaps/searchOnLoad/"+e)]),this.$http.isError(o)||(this.$store.commit("beatmaps/setSelectedBeatmap",o),this.$bs.showModal("editBeatmap"))):t=await this.$http.initialRequest("/beatmaps/relevantInfo"),this.$http.isError(t)||(this.$store.commit("beatmaps/setUserBeatmaps",t.beatmaps),this.$store.commit("beatmaps/setFilterMode",t.mainMode)),await Promise.all([this.loadGuestBeatmaps(),this.$store.dispatch("beatmaps/loadOtherBeatmaps")]),this.isLoadingGuestBeatmaps=!1},methods:{async loadGuestBeatmaps(){const e=await this.$http.executeGet("/beatmaps/guestBeatmaps");e&&this.$store.commit("beatmaps/setUserBeatmaps",e.userBeatmaps)}}}),_i=s("div",{class:"radial-divisor"},null,-1),ki=s("div",{class:"radial-divisor"},null,-1);function $i(e,t,o,l,r,h){const u=f("beatmap-page-filters"),n=f("hosted-beatmaps"),p=f("guest-difficulties"),g=f("other-beatmaps"),d=f("edit-beatmap-modal"),S=f("create-beatmap-modal");return a(),i("div",null,[k(u),k(n),_i,k(p,{"is-loading-guest-beatmaps":e.isLoadingGuestBeatmaps},null,8,["is-loading-guest-beatmaps"]),ki,k(g),k(d,{"selected-beatmap":e.selectedBeatmap},null,8,["selected-beatmap"]),k(S)])}const Mi=B(bi,[["render",$i]]);export{Mi as default};
