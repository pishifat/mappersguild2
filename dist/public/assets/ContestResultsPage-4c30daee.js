import{d as k,a0 as I,m as C,_ as w,o as t,e as o,a as e,j as m,t as c,i as S,z as U,k as l,F as g,r as _,c as y,b as f,q as $,s as R,n as j,C as V}from"./index-c8d4ec2c.js";const z={state:{contest:null,submissions:[],submission:null},mutations:{setContest(s,n){s.contest=n},setSubmissions(s,n){s.submissions=n},setSubmission(s,n){s.submission=n}}},N=z,T=k({name:"SubmissionResult",components:{UserLink:I},data(){return{userScreeningId:""}},computed:{...C({submission:s=>s.contestResults.submission,loggedInUser:s=>s.loggedInUser}),voteCount(){let s=0;return this.submission.screenings.forEach(n=>{isNaN(n.vote)||(s+=n.vote)}),s},emptyScreeningCount(){return this.submission.contest.screeners.length-this.submission.screenings.length},randomizedJudging(){let s=[...this.submission.judgings];return s=s.sort(()=>Math.random()-.5),s},randomizedScreening(){let s=[...this.submission.screenings];return s=s.sort(()=>Math.random()-.5),s}},async created(){if(this.loggedInUser){const s=await this.$http.executeGet(`/contests/results/userScreening/${this.submission.contest.id}/${this.submission.id}/${this.loggedInUser.id}`);this.$http.isError(s)||(this.userScreeningId=s)}},methods:{findTotalJudgingPoints(s){let n=0;return s.forEach(i=>{n+=i.score}),n},findTotalCriteriaPoints(s){let n=0;return s.forEach(i=>{n+=i.criteria.maxScore}),n},findJudgeComment(s){let n="";return s.forEach(i=>{i.criteria.name=="comments"&&(n=i.comment)}),n},filteredAndSortedJudgingScores(s){s=s.filter(i=>i.criteria.name!="comments");const n=["musical representation","creativity","limitation","gameplay"];return[...s].sort(function(i,a){return n.indexOf(i.criteria.name)-n.indexOf(a.criteria.name)})}}}),E={key:0,class:"container p-3"},F=["href"],J=e("i",{class:"fa fa-arrow-left"},null,-1),M={key:0},P={key:1,class:"mt-2"},q=["href"],A=e("hr",null,null,-1),D={class:"mx-2"},B=e("h5",null," Screening results ",-1),O={key:0},X=e("p",{class:"ms-3"}," Comments are usually each screener's initial thoughts. They're not intended to be constructive feedback and many screeners use comments as notes for determining their top picks. ",-1),G={class:"ms-3"},L={key:1},Y={key:2,class:"fas fa-check text-done ms-1"},H={class:"ms-4 mb-2 small text-secondary",style:{"word-break":"break-word"}},K={class:"ms-3"},Q=e("div",{class:"ms-4 mb-2 small text-secondary",style:{"word-break":"break-word"}}," [no comment] ",-1),W={key:1,class:"ms-3"},Z=e("hr",null,null,-1),x={class:"mx-2"},ss=e("h5",null," Judging results ",-1),es={key:0},ts={key:0,class:"ms-3"},ns={key:1,class:"ms-3"},os={class:"row ms-3"},is={class:"col-sm-5"},rs={class:"table table-sm table-responsive-sm"},cs=e("thead",null,[e("tr",null,[e("th",{class:"text-start"}," Category "),e("th",{class:"text-start"}," Score ")])],-1),as={class:"text-start text-capitalize"},ls={class:"text-start"},us=e("td",{class:"text-start"}," TOTAL ",-1),ds={class:"text-start"},hs={class:"col-sm-7 small"},ms={class:"text-secondary",style:{"white-space":"pre-line"}},gs={key:1,class:"ms-3"};function _s(s,n,i,a,u,v){const d=$("user-link"),h=R("bs-tooltip");return t(),o("div",null,[s.submission?(t(),o("div",E,[e("div",null,[e("h3",null,[e("a",{href:"/contests/results?contest="+s.submission.contest.id},[J,m(" "+c(s.submission.contest.name),1)],8,F)]),e("h4",null,[m(" Submission by "),S(d,{user:s.submission.creator},null,8,["user"])]),e("h5",null,' Anonymized as "'+c(s.submission.name)+'" ',1),s.loggedInUser&&s.loggedInUser.id==s.submission.creator.id?(t(),o("div",M,[e("a",{href:"#",onClick:n[0]||(n[0]=U(r=>s.$store.commit("setSubmission",null),["prevent"]))}," Your other contest submissions ")])):l("",!0),s.submission.contest.download?(t(),o("div",P,[e("div",null,[e("a",{href:s.submission.contest.download,target:"_blank"}," Download all submissions ",8,q)])])):l("",!0)]),A,e("div",D,[B,s.submission.screenings&&s.submission.screenings.length?(t(),o("div",O,[X,(t(!0),o(g,null,_(s.randomizedScreening,(r,b)=>(t(),o("div",{key:r.id},[e("div",null,[e("div",G,[s.userScreeningId&&s.userScreeningId==r.id?(t(),y(d,{key:0,user:s.loggedInUser},null,8,["user"])):(t(),o("span",L,"User "+c(b+1),1)),r.vote?f((t(),o("i",Y,null,512)),[[h,"user placed in top picks"]]):l("",!0)]),e("div",H,c(r.comment?r.comment:"[no comment]"),1)])]))),128)),(t(!0),o(g,null,_(s.emptyScreeningCount,r=>(t(),o("div",{key:r},[e("div",null,[e("div",K," User "+c(s.submission.screenings.length+r),1),Q])]))),128))])):(t(),o("div",W," This contest skipped screening. "))]),Z,e("div",x,[ss,s.submission.judgings&&s.submission.judgings.length?(t(),o("div",es,[(t(!0),o(g,null,_(s.randomizedJudging,(r,b)=>(t(),o("div",{key:r.id},[e("div",null,[s.submission.contest.hasPublicJudges?(t(),o("div",ts,[S(d,{user:r.judge},null,8,["user"])])):(t(),o("div",ns," User "+c(b+1),1)),e("div",os,[e("div",is,[e("table",rs,[cs,e("tbody",null,[(t(!0),o(g,null,_(s.filteredAndSortedJudgingScores(r.judgingScores),p=>(t(),o("tr",{key:p.id},[e("td",as,c(p.criteria.name),1),e("td",ls,c(p.score)+"/"+c(p.criteria.maxScore),1)]))),128)),e("tr",null,[us,e("td",ds,c(s.findTotalJudgingPoints(r.judgingScores))+"/"+c(s.findTotalCriteriaPoints(r.judgingScores)),1)])])])]),e("div",hs,[m(" Comment: "),e("span",ms,c(s.findJudgeComment(r.judgingScores)),1)])])])]))),128))])):(t(),o("div",gs," This entry did not receive enough screening votes to reach the judging stage. :( "))])])):l("",!0)])}const bs=w(T,[["render",_s]]),ps=k({name:"ContestResults",data(){return{usersScores:[]}},computed:{...C({contest:s=>s.contestResults.contest}),maxScore(){let s=0;for(const n of this.contest.criterias)s+=n.maxScore;return s*this.contest.judges.length},sortedSubmissions(){return this.contest.useRawScoring?[...this.contest.submissions].sort((s,n)=>{const i=this.judgeScore(s.judgings);return this.judgeScore(n.judgings)-i}):[...this.contest.submissions.filter(i=>i.judgings&&i.judgings.length)].sort((i,a)=>{const u=this.getFinalScore(i.id);return this.getFinalScore(a.id)-u}).concat([...this.contest.submissions.filter(i=>!i.judgings||i.judgings&&!i.judgings.length)])}},async created(){const s=await this.$http.executeGet(`/contests/listing/${this.contest.id}/getUsersScores`);this.$http.isError(s)||(this.usersScores=s.usersScores)},methods:{voteCount(s,n){let i=0;for(const a of s)a.vote&&!isNaN(a.vote)&&(n?i+=a.vote:i++);return i},judgeScore(s){let n=0;for(const i of s)for(const a of i.judgingScores)n+=a.score;return n},getFinalScore(s){const n=this.usersScores.find(i=>i.submissionId==s);return n?isNaN(n.standardizedFinalScore)?0:parseFloat(n.standardizedFinalScore.toFixed(4)):0}}}),fs={key:0,class:"container p-3"},$s=["href"],vs={key:1},Ss=["href"],ys={class:"table table-sm"},ks={scope:"col"},Cs=e("th",{scope:"col"}," Creator ",-1),ws={key:0,scope:"col"},js={scope:"col"},Rs={key:1,scope:"col"},Is={scope:"row"},Us=["href"],Vs=e("i",{class:"fa fa-arrow-right"},null,-1),zs={scope:"row"},Ns={key:0},Ts=e("i",{class:"fas fa-check text-done me-1"},null,-1),Es=[Ts],Fs={key:0},Js={key:1},Ms={key:0},Ps={key:1};function qs(s,n,i,a,u,v){const d=$("user-link"),h=R("bs-tooltip");return t(),o("div",null,[s.contest?(t(),o("div",fs,[e("h4",null,[s.contest.url||s.contest.resultsUrl?(t(),o("a",{key:0,href:s.contest.resultsUrl?s.contest.resultsUrl:s.contest.url,target:"_blank"},c(s.contest.name)+" results ",9,$s)):(t(),o("span",vs,c(s.contest.name)+" results",1))]),e("div",null,[e("a",{href:s.contest.download,target:"_blank"}," Download all submissions ("+c(s.contest.submissions.length)+") ",9,Ss)]),e("table",ys,[e("thead",null,[e("tr",null,[f((t(),o("th",ks,[m(" Submission ")])),[[h,"anonymized name seen by screeners/judges"]]),Cs,s.contest.judgingThreshold?f((t(),o("th",ws,[m(" Screener votes ("+c(s.contest.screeners.length*s.contest.screeningVoteCount)+") ",1)])),[[h,`screeners sort entries in their ordered top ${s.contest.screeningVoteCount}. #1 adds ${s.contest.screeningVoteCount} points, #2 adds ${s.contest.screeningVoteCount-1} points, #3 adds ${s.contest.screeningVoteCount-2}, etc.`]]):l("",!0),e("th",js," Raw scores ("+c(s.maxScore)+") ",1),s.contest.useRawScoring?l("",!0):f((t(),o("th",Rs,[m(" Standardized scores ")])),[[h,"judge X's final score = (judge X's raw score - judge X's average raw score) / judge X's standard deviation"]])])]),e("tbody",null,[(t(!0),o(g,null,_(s.sortedSubmissions,r=>(t(),o("tr",{key:r.id+"screen"},[e("td",Is,[e("a",{href:"/contests/results?submission="+r.id},[m(c(r.name)+" ",1),Vs],8,Us)]),e("td",zs,[S(d,{user:r.creator},null,8,["user"])]),s.contest.judgingThreshold?(t(),o("td",Ns,[(t(!0),o(g,null,_(s.voteCount(r.screenings),b=>(t(),o("span",{key:b},Es))),128)),s.voteCount(r.screenings,!0)>0?(t(),o("span",Fs," ("+c(s.voteCount(r.screenings,!0))+") ",1)):l("",!0)])):l("",!0),e("td",null,[e("span",{class:j(s.contest.useRawScoring&&s.judgeScore(r.judgings)>0?"text-done":"")},c(s.judgeScore(r.judgings)||"N/A"),3)]),s.contest.useRawScoring?l("",!0):(t(),o("td",Js,[e("span",{class:j(s.judgeScore(r.judgings)>0?"text-done":"")},[s.usersScores.length?(t(),o("div",Ps,c(s.getFinalScore(r.id)||"N/A"),1)):(t(),o("div",Ms,"calculating..."))],2)]))]))),128))])])])):l("",!0)])}const As=w(ps,[["render",qs]]),Ds=k({name:"ContestResultsPage",components:{SubmissionResult:bs,ContestResults:As},computed:{...C({contest:s=>s.contestResults.contest,submissions:s=>s.contestResults.submissions,submission:s=>s.contestResults.submission})},beforeCreate(){this.$store.hasModule("contestResults")||this.$store.registerModule("contestResults",N)},unmounted(){this.$store.hasModule("contestResults")&&this.$store.unregisterModule("contestResults")},async created(){const s=this.$route.query.contest,n=this.$route.query.submission;let i,a,u;s?(i=await this.$http.initialRequest("/contests/results/searchContest/"+s),this.$http.isError(i)||this.setContest(i)):n?([u,a]=await Promise.all([this.$http.initialRequest("/contests/results/searchSubmission/"+n),this.$http.executeGet("/contests/results/participated")]),!u||this.$http.isError(u)?this.$router.replace("/contests/results"):this.setSubmission(u)):a=await this.$http.initialRequest("/contests/results/participated"),this.$http.isError(a)||this.setSubmissions(a)},methods:{...V(["setContest","setSubmissions","setSubmission"])}}),Bs={class:"container card card-body"},Os={key:2,class:"row"},Xs={class:"card card-level-2 card-body"},Gs=["href"],Ls=["href"],Ys={key:3,class:"text-center"};function Hs(s,n,i,a,u,v){const d=$("contest-results"),h=$("submission-result");return t(),o("div",Bs,[s.contest?(t(),y(d,{key:0})):s.submission?(t(),y(h,{key:1})):s.submissions.length?(t(),o("div",Os,[(t(!0),o(g,null,_(s.submissions,r=>(t(),o("div",{key:r.id,class:"col-sm-4 my-2"},[e("div",Xs,[e("p",null,[e("a",{href:`/contests/results?contest=${r.contest.id}`},c(r.contest.name),9,Gs)]),e("a",{href:`/contests/results?submission=${r.id}`,class:"small text-end"}," view submission details ",8,Ls)])]))),128))])):(t(),o("div",Ys," Contests you participated in will show up here! "))])}const Qs=w(Ds,[["render",Hs]]);export{Qs as default};
