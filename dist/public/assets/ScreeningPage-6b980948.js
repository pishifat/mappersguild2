import{d as _,m as v,D as I,_ as b,o,e as i,F as C,r as y,n as p,z as k,a as t,b as w,t as f,f as M,s as N,i as S,q as g,u as U,x as q,j as u,c as $,k as V,w as F,l as T}from"./index-fe01c0c0.js";import{C as B}from"./ContestCard-6da0200c.js";var L=(e=>(e[e.First=5]="First",e[e.Second=4]="Second",e[e.Third=3]="Third",e[e.Fourth=2]="Fourth",e[e.Fifth=1]="Fifth",e[e.None=0]="None",e))(L||{});const E=_({name:"ScreeningVote",props:{submissionId:{type:String,required:!0},savedVote:{type:Number,default:0},screeningVoteCount:{type:Number,default:0}},computed:{...v({voteLoading:e=>e.screening.voteLoading}),...I(["usedVotes"])},methods:{async updateVote(e){this.$store.commit("setVoteLoading",!0),this.savedVote==e&&(e=L.None);const s=await this.$http.executePost("/contests/screening/updateSubmission/"+this.submissionId,{vote:e});this.$http.isError(s)||this.$store.commit("updateSubmission",s),this.$store.commit("setVoteLoading",!1)}}});const D=["disabled","onClick"];function R(e,s,c,r,d,l){return o(),i("div",null,[(o(!0),i(C,null,y(e.screeningVoteCount,n=>(o(),i("a",{key:n,class:p(["mx-1",{"disabled-star":e.usedVotes.includes(n)&&e.savedVote!=n||e.voteLoading}]),disabled:e.voteLoading,href:"#",onClick:k(a=>e.updateVote(n),["prevent"])},[t("i",{class:p(["fa-star fas",{"text-warning":e.usedVotes.includes(n)&&e.savedVote==n}])},null,2)],10,D))),128))])}const A=b(E,[["render",R],["__scopeId","data-v-c0766042"]]),O=_({name:"ScreeningNotes",props:{submissionId:{type:String,required:!0},savedComment:{type:String,default:""}},data(){return{showCommentInput:!1,newComment:this.savedComment}},methods:{cancelUpdate(){this.showCommentInput=!this.showCommentInput,this.newComment=this.savedComment},async updateComment(e){if(this.savedComment!=this.newComment){const s=await this.$http.executePost("/contests/screening/updateSubmission/"+this.submissionId,{comment:this.newComment.trim()},e);this.$http.isError(s)||(this.showCommentInput=!this.showCommentInput,this.$store.commit("updateSubmission",s))}else this.showCommentInput=!this.showCommentInput}}}),j={class:""},z=t("i",{class:"fas fa-edit"},null,-1),G=[z],Y={key:0,class:"small text-secondary ms-1"},H={class:"text-end"};function J(e,s,c,r,d,l){const n=N("bs-tooltip");return o(),i("div",j,[w((o(),i("a",{href:"#",onClick:s[0]||(s[0]=k(a=>e.showCommentInput=!e.showCommentInput,["prevent"]))},G)),[[n,"edit comment","left"]]),e.showCommentInput?(o(),i(C,{key:1},[w(t("textarea",{"onUpdate:modelValue":s[1]||(s[1]=a=>e.newComment=a),class:"form-control form-control-sm",rows:"4",type:"text",placeholder:"map comments...",style:{overflow:"hidden","overflow-wrap":"break-word"},maxlength:"1000"},null,512),[[M,e.newComment,void 0,{trim:!0}]]),t("div",H,[t("button",{type:"button",class:"btn btn-sm btn-outline-info mt-1 mx-1",onClick:s[2]||(s[2]=a=>e.cancelUpdate())}," Cancel "),t("button",{type:"button",class:"btn btn-sm btn-outline-info mt-1 mx-1",onClick:s[3]||(s[3]=a=>e.updateComment(a))}," Save ")])],64)):(o(),i("span",Y,f(e.newComment||"..."),1))])}const K=b(O,[["render",J]]),Q=_({name:"SubmissionCard",components:{ScreeningVote:A,ScreeningNotes:K},props:{submission:{type:Object,required:!0},screeningVoteCount:{type:Number,default:0}},data(){return{disableStrikethrough:!1}},computed:{...v(["loggedInUser"]),relatedScreening(){return this.submission.screenings.find(e=>e.screener._id===this.loggedInUser.id)}},methods:{async toggleReviewed(){this.disableStrikethrough=!0;const e=await this.$http.executePost("/contests/screening/updateSubmission/"+this.submission.id,{toggleReviewed:!0});this.$http.isError(e)||(this.$store.commit("updateSubmission",e),this.disableStrikethrough=!1)}}});const W=e=>(U("data-v-33854770"),e=e(),q(),e),X={class:"col-sm-12 my-1"},Z={class:"card-body p-2"},x={class:"row"},P={class:"col-sm-6"},ee=W(()=>t("i",{class:"fa-solid fa-strikethrough"},null,-1)),se=[ee],te={class:"col-sm-6 text-end"},oe={class:"row"},ne={class:"col-sm"};function ie(e,s,c,r,d,l){const n=g("screening-vote"),a=g("screening-notes"),h=N("bs-tooltip");return o(),i("div",X,[t("div",{class:p(["card",e.relatedScreening&&e.relatedScreening.vote?"bg-vote":"bg-dark"])},[t("div",Z,[t("div",x,[t("div",P,[w((o(),i("a",{class:p(e.disableStrikethrough?"fake-button-disable":""),href:"#",onClick:s[0]||(s[0]=k(m=>e.toggleReviewed(),["prevent"]))},se,2)),[[h,"strikethrough text","left"]]),t("span",{class:p(["ms-1",e.relatedScreening&&e.relatedScreening.reviewed?"text-decoration-line-through text-secondary":""])},f(e.submission.name),3)]),t("div",te,[S(n,{"submission-id":e.submission.id,"saved-vote":e.relatedScreening&&e.relatedScreening.vote,"screening-vote-count":e.screeningVoteCount},null,8,["submission-id","saved-vote","screening-vote-count"])])]),t("div",oe,[t("div",ne,[S(a,{"submission-id":e.submission.id,"saved-comment":e.relatedScreening&&e.relatedScreening.comment},null,8,["submission-id","saved-comment"])])])])],2)])}const re=b(Q,[["render",ie],["__scopeId","data-v-33854770"]]),de=_({name:"ScreeningInstructions",computed:{...I(["selectedContest"])}}),ae={class:"mb-2"},ce=t("span",{class:"text-secondary"},"If the contest has a theme/additional rules, consider those when making your choices.",-1),le=t("i",{class:"fa-star fas text-warning"},null,-1),ue=t("span",{class:"text-secondary"},[u("The star on the "),t("b",null,"left is the lowest score"),u(", while the star on the "),t("b",null,"right is the highest score"),u(".")],-1),me=t("li",null,[u("Submissions are sorted randomly every time you load the page. "),t("span",{class:"text-secondary"},[u("You can use the "),t("i",{class:"fa-solid fa-strikethrough"}),u(" button to mark maps you've checked (only for your own reference).")])],-1),he=t("li",null,[u("Comments are not required. "),t("span",{class:"text-secondary"},"They're nice to include though, especially for your top picks and for new mappers. Comments will be seen by the map creator, but your name will be anonymous.")],-1),pe=t("li",{class:"text-danger"},[t("b",null,"DO NOT discuss your choices with other screeners or outsiders until after the contest is concluded.")],-1);function ge(e,s,c,r,d,l){return o(),i("div",ae,[t("ol",null,[t("li",null,[u("Mark your personal "),t("b",null,"top "+f(e.selectedContest.screeningVoteCount),1),u(" submissions with stars. "),ce]),t("li",null,[u(" Stars "),le,u(" indicate the order of your top "+f(e.selectedContest.screeningVoteCount)+". ",1),ue]),me,he,pe])])}const fe=b(de,[["render",ge]]),_e={state:{contests:[],selectedContestId:null,voteLoading:!1},mutations:{setContests(e,s){e.contests=s},setSelectedContestId(e,s){e.selectedContestId=s},setVoteLoading(e,s){e.voteLoading=s},updateSubmission(e,s){let c=-1;const r=e.contests.findIndex(d=>{if(c=d.submissions.findIndex(l=>l.id===s.id),c!==-1)return!0});r!==-1&&c!==-1&&(e.contests[r].submissions[c]=s)}},getters:{selectedContest:e=>e.contests.find(s=>s.id===e.selectedContestId),usedVotes:(e,s,c)=>{const r=s.selectedContest,d=[];return r.submissions.forEach(l=>{const n=l.screenings.find(a=>{var h;return a.screener.id===((h=c.loggedInUser)==null?void 0:h.id)});n&&d.push(n.vote)}),d}}},be=_e,ve=_({name:"ScreeningPage",components:{SubmissionCard:re,ContestCard:B,ScreeningInstructions:fe},data(){return{loadedSpecificContest:!1}},computed:{...v({contests:e=>e.screening.contests}),...v(["loggedInUser"]),...I(["selectedContest"]),sortedSubmissions(){const e=[...this.selectedContest.submissions];return e.sort((s,c)=>{const r=s.name,d=c.name;return r<d?-1:r>d?1:0}),e.sort((s,c)=>{const r=s.screenings.find(a=>a.screener._id===this.loggedInUser.id),d=c.screenings.find(a=>a.screener._id===this.loggedInUser.id),l=r&&r.vote?r.vote:0,n=d&&d.vote?d.vote:0;return l<n?1:l>n?-1:0}),e}},beforeCreate(){this.$store.hasModule("screening")||this.$store.registerModule("screening",be)},unmounted(){this.$store.hasModule("screening")&&this.$store.unregisterModule("screening")},async created(){await this.loadContests()},methods:{async loadContests(){const e=this.$route.query.contest;if(e&&!this.contests.length){const s=await this.$http.initialRequest(`/contests/screening/searchContest/${e}`);this.$http.isError(s)||(this.$store.commit("setContests",[s]),this.$store.commit("setSelectedContestId",e),this.loadedSpecificContest=!0)}else{this.$router.replace("/contests/screening");const s=await this.$http.initialRequest("/contests/screening/relevantInfo");this.$http.isError(s)||(this.$store.commit("setContests",s||[]),this.$store.commit("setSelectedContestId",null),this.loadedSpecificContest=!1)}},async loadMore(){await this.loadContests()}}}),Ce={class:"container card card-body py-1"},$e={key:0,class:"row"},ye={key:0,class:"col-sm-4 my-2"},we={key:1},Se=t("hr",null,null,-1),Ie={class:"my-2"},ke=["href"],Ve={class:"mb-2"},Ne=t("hr",null,null,-1),Le={key:1,class:"ms-4"},Me={key:1,class:"text-center p-3"};function Ue(e,s,c,r,d,l){const n=g("contest-card"),a=g("screening-instructions"),h=g("submission-card");return o(),i("div",Ce,[e.contests&&e.contests.length?(o(),i("div",$e,[(o(!0),i(C,null,y(e.contests,m=>(o(),$(n,{key:m.id,class:"col-sm-4 my-2",contest:m,route:"screening"},null,8,["contest"]))),128)),e.loadedSpecificContest?(o(),i("div",ye,[t("button",{class:"btn w-100 btn-info h-100",type:"button",onClick:s[0]||(s[0]=m=>e.loadMore())}," Load other contests ")])):V("",!0),e.selectedContest?(o(),i("div",we,[Se,t("h4",Ie,f(e.selectedContest.name),1),t("h5",null,[t("a",{href:e.selectedContest.download,target:"_blank"}," Download all submissions ",8,ke)]),t("div",Ve,[S(a,{id:"screeningInstructions"}),Ne]),e.selectedContest.submissions.length?(o(),$(T,{key:0,name:"list",tag:"div",class:"row"},{default:F(()=>[(o(!0),i(C,null,y(e.sortedSubmissions,m=>(o(),$(h,{key:m.id,submission:m,"screening-vote-count":e.selectedContest.screeningVoteCount},null,8,["submission","screening-vote-count"]))),128))]),_:1})):(o(),i("p",Le," No submissions... "))])):V("",!0)])):(o(),i("div",Me," No contests available for screening. "))])}const Te=b(ve,[["render",Ue]]);export{Te as default};
