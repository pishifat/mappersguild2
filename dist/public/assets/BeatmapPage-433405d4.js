import{d as v,_ as y,o,e as l,a,b as A,f as S,i as m,w as p,F as h,r as f,j as B,t as i,k as b,q as _,g as D,z as g,n as $,M as N,m as U,c as w}from"./index-c0553a8f.js";import{C as M}from"./CopyPaste-5fa800a9.js";import{B as E}from"./BeatmapInfoAdmin-bb00e0a0.js";import{D as G}from"./DataTable-01b5580b.js";import"./ModalDialog-ed4667a7.js";import"./TasksChoice-377f005d.js";const L=v({name:"ContributorStats",components:{CopyPaste:M},data(){return{date:"2022-07-24",externalBeatmaps:[],users:[]}},methods:{async loadNewsInfo(t){const s=await this.$http.executeGet("/admin/beatmaps/loadNewsInfo/"+this.date,t);s&&(this.users=s.users)},separateCommas(t,s){return t<s-1?", ":""}}}),V={class:"container card card-body py-3 mt-2"},P=a("h5",null,"Mappers' Guild contributor stats",-1),R={class:"form-inline"},Y={class:"form-group"},W={key:0},j=a("p",null," Users with ranked maps/tasks: ",-1),z=a("div",null," | User | Modes | Ranked beatmaps | Ranked difficulties | ",-1),H=a("div",null," | :-- | :-- | :-- | :-- | ",-1);function K(t,s,n,d,k,I){const u=_("copy-paste");return o(),l("div",V,[P,a("div",R,[a("div",Y,[a("button",{class:"btn btn-sm btn-info",onClick:s[0]||(s[0]=e=>t.loadNewsInfo(e))}," Generate Mappers' Guild contributors stats "),A(a("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>t.date=e),class:"form-control form-control-sm d-inline mx-2 w-25",type:"text",autocomplete:"off",placeholder:"YYYY-MM-DD"},null,512),[[S,t.date]])])]),t.users&&t.users.length?(o(),l("div",W,[j,m(u,{distinct:"users"},{default:p(()=>[z,H,(o(!0),l(h,null,f(t.users,e=>(o(),l("div",{key:e.id},[B(" | "+i(e.flag)+" ["+i(e.username)+"]("+i("https://osu.ppy.sh/users/"+e.osuId)+") | ",1),(o(!0),l(h,null,f(e.modes,(r,C)=>(o(),l("span",{key:r},i(r=="osu"?"osu!":r=="sb"?"Storyboarder":r=="hs"?"Hitsounder":"osu!"+r)+i(t.separateCommas(C,e.modes.length)),1))),128)),B(" | "+i(e.hostCount)+" | "+i(e.taskCount)+" | ",1)]))),128))]),_:1})])):b("",!0)])}const q=y(L,[["render",K]]),J=v({name:"OsuApiBeatmapSearch",components:{CopyPaste:M},data(){return{osuId:null,output:null}},methods:{async searchBeatmap(t){const s=await this.$http.executePost("/admin/beatmaps/searchBeatmap",{osuId:this.osuId},t);s&&!s.error&&(this.output=s)}}}),Q={class:"container card card-body py-1"},X=a("h5",{class:"mt-2"}," Search beatmap in osu! API ",-1),Z={key:0};function x(t,s,n,d,k,I){const u=_("copy-paste");return o(),l("div",Q,[X,A(a("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>t.osuId=e),class:"form-control form-control-sm mb-2",type:"text",maxlength:"18",autocomplete:"off",placeholder:"search by osuID...",onKeyup:s[1]||(s[1]=D(e=>t.searchBeatmap(e),["enter"]))},null,544),[[S,t.osuId]]),a("button",{class:"btn btn-sm w-100 btn-info mb-2",onClick:s[2]||(s[2]=e=>t.searchBeatmap(e))}," Load beatmap "),t.output?(o(),l("div",Z,[m(u,null,{default:p(()=>[a("pre",null,i(t.output),1)]),_:1})])):b("",!0)])}const tt=y(J,[["render",x]]),et=v({name:"BundledBeatmapsList",components:{CopyPaste:M},data(){return{bundledBeatmaps:[]}},computed:{osuBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="osu")},taikoBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="taiko")},catchBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="catch")},maniaBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="mania")},osuFinalBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="osu"&&t.isBundled)},taikoFinalBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="taiko"&&t.isBundled)},catchFinalBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="catch"&&t.isBundled)},maniaFinalBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="mania"&&t.isBundled)}},methods:{async findBundledBeatmaps(t){const s=await this.$http.executeGet("/admin/beatmaps/findBundledBeatmaps",t);s&&!s.error&&(this.bundledBeatmaps=s)},async toggleIsBundled(t,s){const n=await this.$http.executePost("/admin/beatmaps/"+t+"/toggleIsBundled",{isBundled:s});if(!this.$http.isError(n)){const d=[...this.bundledBeatmaps],k=d.findIndex(I=>I.id==t);d[k]=n,this.bundledBeatmaps=d}},findOsuId(t){const s=t.indexOf("beatmapsets/")+12,n=t.indexOf("#");let d="";return n!==-1?d=t.slice(s,n):d=t.slice(s),parseInt(d,10)}}}),st={class:"container card card-body py-3 mt-2"},at=a("h5",null,"Bundled beatmap list generator",-1),nt={key:0,class:"row mt-3 small"},ot={class:"col-sm-6"},dt=["onClick"],it=["href"],lt={class:"col-sm-6"},rt=["onClick"],ut=["href"],ct={class:"col-sm-6"},mt=["onClick"],pt=["href"],ht={class:"col-sm-6"},ft=["onClick"],Bt=["href"],_t=a("p",null,"final lists",-1),kt={class:"row"},gt={class:"col-sm-3"},$t=["href"],bt=["onClick"],It={class:"col-sm-3"},vt=["href"],yt=["onClick"],Ct={class:"col-sm-3"},wt=["href"],Mt=["onClick"],At={class:"col-sm-3"},St=["href"],Ft=["onClick"];function Ot(t,s,n,d,k,I){const u=_("copy-paste");return o(),l("div",st,[at,a("button",{class:"btn btn-sm w-100 btn-info",onClick:s[0]||(s[0]=e=>t.findBundledBeatmaps(e))}," Load beatmaps with ENHI+ spreads "),t.bundledBeatmaps.length?(o(),l("div",nt,[a("div",ot,[B(" osu ("+i(t.osuBeatmaps.length)+") ",1),m(u,{distinct:"osu"},{default:p(()=>[(o(!0),l(h,null,f(t.osuBeatmaps,e=>(o(),l("div",{key:e.id},[a("a",{href:"#",class:"me-1",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[a("i",{class:$(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,dt),a("a",{href:e.url,target:"_blank"},i(e.song.artist+" - "+e.song.title)+" ("+i(t.findOsuId(e.url))+")",9,it)]))),128))]),_:1})]),a("div",lt,[B(" taiko ("+i(t.taikoBeatmaps.length)+") ",1),m(u,{distinct:"taiko"},{default:p(()=>[(o(!0),l(h,null,f(t.taikoBeatmaps,e=>(o(),l("div",{key:e.id},[a("a",{href:"#",class:"me-1",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[a("i",{class:$(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,rt),a("a",{href:e.url,target:"_blank"},i(e.song.artist+" - "+e.song.title)+" ("+i(t.findOsuId(e.url))+")",9,ut)]))),128))]),_:1})]),a("div",ct,[B(" catch ("+i(t.catchBeatmaps.length)+") ",1),m(u,{distinct:"catch"},{default:p(()=>[(o(!0),l(h,null,f(t.catchBeatmaps,e=>(o(),l("div",{key:e.id},[a("a",{href:"#",class:"me-1",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[a("i",{class:$(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,mt),a("a",{href:e.url,target:"_blank"},i(e.song.artist+" - "+e.song.title)+" ("+i(t.findOsuId(e.url))+")",9,pt)]))),128))]),_:1})]),a("div",ht,[B(" mania ("+i(t.maniaBeatmaps.length)+") ",1),m(u,{distinct:"mania"},{default:p(()=>[(o(!0),l(h,null,f(t.maniaBeatmaps,e=>(o(),l("div",{key:e.id},[a("a",{href:"#",class:"me-1",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[a("i",{class:$(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,ft),a("a",{href:e.url,target:"_blank"},i(e.song.artist+" - "+e.song.title)+" ("+i(t.findOsuId(e.url))+")",9,Bt)]))),128))]),_:1})]),_t,a("div",kt,[a("div",gt,[B(" osu ("+i(t.osuFinalBeatmaps.length)+") ",1),m(u,{distinct:"osufinal"},{default:p(()=>[(o(!0),l(h,null,f(t.osuFinalBeatmaps,e=>(o(),l("div",{key:e.id},[a("a",{href:e.url,target:"_blank",class:"me-1"},i(t.findOsuId(e.url)),9,$t),a("a",{href:"#",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[a("i",{class:$(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,bt)]))),128))]),_:1})]),a("div",It,[B(" taiko ("+i(t.taikoFinalBeatmaps.length)+") ",1),m(u,{distinct:"taiko"},{default:p(()=>[(o(!0),l(h,null,f(t.taikoFinalBeatmaps,e=>(o(),l("div",{key:e.id},[a("a",{href:e.url,target:"_blank",class:"me-1"},i(t.findOsuId(e.url)),9,vt),a("a",{href:"#",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[a("i",{class:$(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,yt)]))),128))]),_:1})]),a("div",Ct,[B(" catch ("+i(t.catchFinalBeatmaps.length)+") ",1),m(u,{distinct:"catch"},{default:p(()=>[(o(!0),l(h,null,f(t.catchFinalBeatmaps,e=>(o(),l("div",{key:e.id},[a("a",{href:e.url,target:"_blank",class:"me-1"},i(t.findOsuId(e.url)),9,wt),a("a",{href:"#",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[a("i",{class:$(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,Mt)]))),128))]),_:1})]),a("div",At,[B(" mania ("+i(t.maniaFinalBeatmaps.length)+") ",1),m(u,{distinct:"mania"},{default:p(()=>[(o(!0),l(h,null,f(t.maniaFinalBeatmaps,e=>(o(),l("div",{key:e.id},[a("a",{href:e.url,target:"_blank",class:"me-1"},i(t.findOsuId(e.url)),9,St),a("a",{href:"#",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[a("i",{class:$(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,Ft)]))),128))]),_:1})])])])):b("",!0)])}const Tt=y(et,[["render",Ot]]),Dt={state:{beatmaps:[]},mutations:{setBeatmaps(t,s){t.beatmaps=s},updateBeatmap(t,s){const n=t.beatmaps.findIndex(d=>d.id===s.id);n!==-1&&(t.beatmaps[n]=s)},updateBeatmapStatus(t,s){const n=t.beatmaps.find(d=>d.id==s.beatmapId);n&&(n.status=s.status)},deleteTask(t,s){const n=t.beatmaps.find(d=>d.id==s.beatmapId);if(n){const d=n.tasks.findIndex(k=>k.id==s.taskId);d!==-1&&n.tasks.splice(d,1)}},deleteModder(t,s){const n=t.beatmaps.find(d=>d.id==s.beatmapId);if(n){const d=n.modders.findIndex(k=>k.id==s.modderId);d!==-1&&n.modders.splice(d,1)}},updateUrl(t,s){const n=t.beatmaps.find(d=>d.id==s.beatmapId);n&&(n.url=s.url)},updateIsShowcase(t,s){const n=t.beatmaps.find(d=>d.id==s.beatmapId);n&&(n.isShowcase=s.isShowcase)},updateIsWorldCup(t,s){const n=t.beatmaps.find(d=>d.id==s.beatmapId);n&&(n.isWorldCup=s.isWorldCup)}}},Nt=Dt,Ut=v({components:{ContributorStats:q,DataTable:G,BeatmapInfoAdmin:E,OsuApiBeatmapSearch:tt,BundledBeatmapsList:Tt,ModesIcons:N},data(){return{selectedBeatmapId:""}},computed:{...U({beatmaps:t=>t.beatmapsAdmin.beatmaps}),selectedBeatmap(){return this.beatmaps.find(t=>t.id===this.selectedBeatmapId)}},beforeCreate(){this.$store.hasModule("beatmapsAdmin")||this.$store.registerModule("beatmapsAdmin",Nt)},unmounted(){this.$store.hasModule("beatmapsAdmin")&&this.$store.unregisterModule("beatmapsAdmin")},methods:{async loadBeatmaps(t){const s=await this.$http.executeGet("/admin/beatmaps/load",t);this.$http.isError(s)||this.$store.commit("setBeatmaps",s)},updateBeatmap(t){const s=this.beatmaps.findIndex(n=>n.id==t.id);s!==-1&&(this.beatmaps[s]=t)},formatMetadata(t){if(!t)return"";let s=t.artist+" - ";return t.title.length>40?s+=t.title.slice(0,40)+"...":s+=t.title,s}}}),Et={class:"container card card-body py-3"},Gt=a("h5",null,"Beatmaps list",-1),Lt={class:"text-truncate"},Vt=["href"],Pt={key:1,class:"ms-1"};function Rt(t,s,n,d,k,I){const u=_("modes-icons"),e=_("user-link"),r=_("data-table"),C=_("beatmap-info-admin"),F=_("osu-api-beatmap-search"),O=_("contributor-stats"),T=_("bundled-beatmaps-list");return o(),l("div",null,[a("div",Et,[Gt,a("button",{class:"btn btn-sm btn-info w-100",onClick:s[0]||(s[0]=c=>t.loadBeatmaps(c))}," Load all beatmaps "),t.beatmaps.length?(o(),w(r,{key:0,data:t.beatmaps,headers:["METADATA","CREATOR","STATUS"],"custom-data-target":"#editBeatmap","onUpdate:selectedId":s[1]||(s[1]=c=>t.selectedBeatmapId=c)},{default:p(({obj:c})=>[a("td",Lt,[m(u,{modes:[c.mode]},null,8,["modes"]),c.url?(o(),l("a",{key:0,href:c.url,class:"ms-1"},i(t.formatMetadata(c.song)),9,Vt)):(o(),l("span",Pt,i(t.formatMetadata(c.song)),1))]),a("td",null,[c.host?(o(),w(e,{key:0,user:c.host},null,8,["user"])):b("",!0)]),a("td",null,i(c.status),1)]),_:1},8,["data"])):b("",!0)]),t.selectedBeatmap?(o(),w(C,{key:0,beatmap:t.selectedBeatmap,onUpdateBeatmap:s[2]||(s[2]=c=>t.updateBeatmap(c))},null,8,["beatmap"])):b("",!0),m(F,{class:"mt-2"}),m(O),m(T)])}const qt=y(Ut,[["render",Rt]]);export{qt as default};
