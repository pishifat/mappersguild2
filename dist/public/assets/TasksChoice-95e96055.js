import{d as w,T as g,B as f,S as y,_ as B,o as t,e as o,a as i,b as m,v as A,F as k,r as $,t as I,k as r,f as E,g as N,j as O,z as p,s as L,M as P,m as D,i as _,w as H,n as V,c as R,l as Q,q as v,u as j,x as W}from"./index-802aa578.js";const q=w({name:"NewTask",props:{isHost:Boolean,taskToAddCollaborator:{type:Object,default:null},beatmap:{type:Object,required:!0},isAdmin:Boolean},emits:["update:taskToAddCollaborator"],data(){return{selectedTask:g.Easy,selectedMode:f.Osu,addTaskUsername:""}},computed:{remainingTasks(){let s=y;return this.beatmap.tasksLocked&&this.beatmap.tasksLocked.length&&!this.isHost&&(s=y.filter(e=>!this.beatmap.tasksLocked.includes(e))),this.beatmap.mode==f.Taiko&&(s=s.filter(e=>e!==g.Hitsounds)),s}},methods:{async addTask(s){let e;this.beatmap.mode==f.Hybrid?e=this.selectedMode:e=this.beatmap.mode;const d=await this.$http.executePost("/beatmaps/addTask/"+this.beatmap.id,{user:this.addTaskUsername,taskName:this.selectedTask,username:this.addTaskUsername,mode:e},s);this.isAdmin?this.$store.commit("updateBeatmap",d):this.$store.dispatch("beatmaps/updateBeatmap",d)},async addCollab(s){let e;this.beatmap.mode==f.Hybrid?e=this.taskToAddCollaborator.mode:e=this.beatmap.mode;const d=await this.$http.executePost("/beatmaps/addCollab/"+this.beatmap.id,{user:this.addTaskUsername,task:this.taskToAddCollaborator,mode:e},s);this.$http.isError(d)||(this.isAdmin?this.$store.commit("updateBeatmap",d):(this.$store.dispatch("beatmaps/updateBeatmap",d),this.$store.dispatch("updateToastMessages",{message:"Added",type:"success"})))}}}),z={key:0,class:"row mt-2 mb-3"},F={class:"col-sm-12"},K={class:"input-group input-group-sm mx-auto"},G=["value"],J=i("option",{value:"osu"}," osu! ",-1),X=i("option",{value:"taiko"}," osu!taiko ",-1),Y=i("option",{value:"catch"}," osu!catch ",-1),Z=i("option",{value:"mania"}," osu!mania ",-1),x=[J,X,Y,Z],ss=i("i",{class:"fas fa-plus"},null,-1),es=[ss],ts={key:0,class:"col-sm-12 mt-1 text-center"},as=i("i",{class:"fas fa-times-circle"},null,-1),os=[as];function is(s,e,d,l,b,M){const T=L("bs-tooltip");return s.beatmap.status=="WIP"&&s.remainingTasks.length||s.isAdmin?(t(),o("div",z,[i("div",F,[i("div",K,[s.taskToAddCollaborator?r("",!0):m((t(),o("select",{key:0,"onUpdate:modelValue":e[0]||(e[0]=n=>s.selectedTask=n),class:"form-select"},[(t(!0),o(k,null,$(s.remainingTasks,n=>(t(),o("option",{key:n,value:n},I(n),9,G))),128))],512)),[[A,s.selectedTask]]),s.beatmap.mode=="hybrid"&&!s.taskToAddCollaborator?m((t(),o("select",{key:1,"onUpdate:modelValue":e[1]||(e[1]=n=>s.selectedMode=n),class:"form-select"},x,512)),[[A,s.selectedMode]]):r("",!0),s.isHost||s.taskToAddCollaborator?m((t(),o("input",{key:2,"onUpdate:modelValue":e[2]||(e[2]=n=>s.addTaskUsername=n),class:"form-control",type:"text",placeholder:"add user to task...",maxlength:"18",onKeyup:e[3]||(e[3]=N(n=>s.taskToAddCollaborator?s.addCollab(n):s.addTask(n),["enter"]))},null,544)),[[E,s.addTaskUsername]]):r("",!0),m((t(),o("button",{class:"btn btn-outline-info",onClick:e[4]||(e[4]=n=>s.taskToAddCollaborator?s.addCollab(n):s.addTask(n))},es)),[[T,"add difficulty"]])])]),s.taskToAddCollaborator?(t(),o("div",ts,[i("small",null,[O(" Adding collaborator for the selected difficulty "),i("a",{class:"text-danger",href:"#",onClick:e[5]||(e[5]=p(n=>s.$emit("update:taskToAddCollaborator",null),["prevent"]))},os)])])):r("",!0)])):r("",!0)}const ds=B(q,[["render",is]]),ns=w({name:"TasksChoice",components:{NewTask:ds,ModesIcons:P},props:{beatmap:{type:Object,required:!0},isHost:Boolean,isRanked:Boolean,isQualified:Boolean,isAdmin:Boolean},data(){return{taskToAddCollaborator:void 0}},computed:{...D(["loggedInUser"]),sortedTasks(){const s=y,e=["osu","taiko","catch","mania","hs","sb"];return[...this.beatmap.tasks].sort(function(l,b){return s.indexOf(l.name)-s.indexOf(b.name)}).sort(function(l,b){return e.indexOf(l.mode)-e.indexOf(b.mode)})}},methods:{isOwner(s){return s.some(e=>e.osuId==this.loggedInUser.osuId)},canEditTask(s){return this.isOwner(s.mappers)||this.isHost},findTaikoName(s){switch(s.toLowerCase()){case"easy":return"Kantan";case"normal":return"Futsuu";case"hard":return"Muzukashii";case"insane":return"Oni";case"expert":return"Inner Oni";default:return s}},findCatchName(s){switch(s.toLowerCase()){case"easy":return"Cup";case"normal":return"Salad";case"hard":return"Platter";case"insane":return"Rain";case"expert":return"Overdose";default:return s}},async setTaskStatus(s,e,d){d.target.classList.add("fake-button-disable");const l=await this.$http.executePost("/beatmaps/setTaskStatus/"+s,{status:e});this.$http.isError(l)||(this.isAdmin?this.$store.commit("updateBeatmap",l):this.$store.dispatch("beatmaps/updateBeatmap",l)),d.target.classList.remove("fake-button-disable")},async removeTask(s,e){e.target.classList.add("fake-button-disable");const d=await this.$http.executePost(`/beatmaps/removeTask/${s}/${this.beatmap.id}`);this.isAdmin?this.$store.commit("updateBeatmap",d):this.$store.dispatch("beatmaps/updateBeatmap",d),e.target.classList.remove("fake-button-disable")},canEditTaskCollaborators(s){return s.status!="Done"&&!this.isQualified&&this.beatmap.status!="Done"&&this.canEditTask(s)},async removeCollab(s,e,d){d.target.classList.add("fake-button-disable");const l=await this.$http.executePost("/beatmaps/task/"+s+"/removeCollab",{user:e});this.isAdmin?this.$store.commit("updateBeatmap",l):this.$store.dispatch("beatmaps/updateBeatmap",l),d.target.classList.remove("fake-button-disable")},isAddingCollaborator(s){var e;return((e=this.taskToAddCollaborator)==null?void 0:e.id)==s.id}}});const c=s=>(j("data-v-802bf977"),s=s(),W(),s),rs={class:"row"},ls={class:"col-sm-12"},us={class:"table table-sm"},ms=c(()=>i("th",null,"Difficulty",-1)),cs=c(()=>i("th",null,"Mapper(s)",-1)),ps={key:0},hs=["id"],bs=c(()=>i("i",{class:"fas fa-times"},null,-1)),ks=[bs],fs=["onClick"],Ts=c(()=>i("i",{class:"fas fa-plus"},null,-1)),Cs=[Ts],_s=["onClick"],vs=c(()=>i("i",{class:"fas fa-minus"},null,-1)),ys=[vs],$s={key:0},gs=["onClick"],As=c(()=>i("i",{class:"fas fa-minus"},null,-1)),ws=[As],Bs=["onClick"],Is=c(()=>i("i",{class:"fas fa-check"},null,-1)),Os=[Is],Ls=["onClick"],Ms=c(()=>i("i",{class:"fas fa-ellipsis-h"},null,-1)),Ss=[Ms],Us={key:0,class:"col-sm-12 mt-2"};function Es(s,e,d,l,b,M){const T=v("modes-icons"),n=v("user-link"),S=v("new-task"),h=L("bs-tooltip");return t(),o("div",rs,[i("div",ls,[i("table",us,[i("thead",null,[i("tr",null,[ms,cs,!s.isRanked&&!s.isQualified?(t(),o("th",ps)):r("",!0)])]),_(Q,{tag:"tbody",name:"list"},{default:H(()=>[(t(!0),o(k,null,$(s.sortedTasks,a=>(t(),o("tr",{id:a.id+"Row",key:a.id},[i("td",{class:V(["text-secondary",`card-status-${a.status.toLowerCase()}`])},[O(I(a.mode=="taiko"?s.findTaikoName(a.name):a.mode=="catch"?s.findCatchName(a.name):a.name)+" ",1),s.beatmap.mode=="hybrid"?(t(),R(T,{key:0,modes:[a.mode],color:"secondary"},null,8,["modes"])):r("",!0)],2),i("td",null,[(t(!0),o(k,null,$(a.mappers,(u,U)=>(t(),o("div",{key:u.id},[U==0&&s.canEditTaskCollaborators(a)?(t(),o(k,{key:0},[s.isAddingCollaborator(a)?m((t(),o("a",{key:0,href:"#",class:"text-danger",onClick:e[0]||(e[0]=p(C=>s.taskToAddCollaborator=void 0,["prevent"]))},ks)),[[h,"cancel"]]):m((t(),o("a",{key:1,href:"#",class:"text-success",onClick:p(C=>s.taskToAddCollaborator=a,["prevent"])},Cs,8,fs)),[[h,"add new collaborator"]])],64)):r("",!0),_(n,{class:"mx-1",user:u},null,8,["user"]),a.mappers.length>1&&s.canEditTaskCollaborators(a)&&u.osuId!=s.loggedInUser.osuId?m((t(),o("a",{key:1,href:"#",class:"text-danger",onClick:p(C=>s.removeCollab(a.id,u.id,C),["prevent"])},ys,8,_s)),[[h,"remove collaborator"]]):r("",!0)]))),128))]),!s.isRanked&&!s.isQualified?(t(),o("td",$s,[s.canEditTask(a)?(t(),o(k,{key:0},[m((t(),o("a",{href:"#",class:"text-danger me-1",onClick:p(u=>s.removeTask(a.id,u),["prevent"])},ws,8,gs)),[[h,"delete"]]),a.status=="WIP"?m((t(),o("a",{key:0,href:"#",class:"text-success me-1",onClick:p(u=>s.setTaskStatus(a.id,"Done",u),["prevent"])},Os,8,Bs)),[[h,"mark as done"]]):r("",!0),a.status=="Done"&&s.beatmap.status!="Done"?m((t(),o("a",{key:1,href:"#",class:"text-wip me-1",onClick:p(u=>s.setTaskStatus(a.id,"WIP",u),["prevent"])},Ss,8,Ls)),[[h,"mark as WIP"]]):r("",!0)],64)):r("",!0)])):r("",!0)],8,hs))),128))]),_:1})])]),!s.isRanked&&!s.isQualified?(t(),o("div",Us,[_(S,{"task-to-add-collaborator":s.taskToAddCollaborator,"onUpdate:taskToAddCollaborator":e[1]||(e[1]=a=>s.taskToAddCollaborator=a),beatmap:s.beatmap,"is-host":s.isHost,"is-admin":s.isAdmin},null,8,["task-to-add-collaborator","beatmap","is-host","is-admin"])])):r("",!0)])}const Ps=B(ns,[["render",Es],["__scopeId","data-v-802bf977"]]);export{Ps as T};
